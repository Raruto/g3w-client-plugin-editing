{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./form/components/relation/vue/relation.html","webpack:///./form/components/relation/vue/relation.js","webpack:///./form/editingform.js","webpack:///./form/editingformservice.js","webpack:///./index.js","webpack:///./panel.js","webpack:///./services/editingservice.js","webpack:///./services/relationservice.js","webpack:///./table/tableservice.js","webpack:///./table/vue/table.html","webpack:///./table/vue/table.js","webpack:///./toolboxes/tool.js","webpack:///./toolboxes/toolboxesfactory.js","webpack:///./toolboxes/toolsfactory.js","webpack:///./vue/components/tool.html","webpack:///./vue/components/tool.js","webpack:///./vue/components/toolbox.html","webpack:///./vue/components/toolbox.js","webpack:///./vue/components/toolsoftool.html","webpack:///./vue/components/toolsoftool.js","webpack:///./vue/components/toolsoftool/tools.js","webpack:///./vue/editing.html","webpack:///./vue/editing.js","webpack:///./workflows/addfeatureworkflow.js","webpack:///./workflows/addtablefeatureworkflow.js","webpack:///./workflows/commitfeaturesworkflow.js","webpack:///./workflows/deletefeatureworkflow.js","webpack:///./workflows/editfeatureattributesworkflow.js","webpack:///./workflows/editingworkflow.js","webpack:///./workflows/edittablefeatureworkflow.js","webpack:///./workflows/edittableworkflow.js","webpack:///./workflows/linkrelationworkflow.js","webpack:///./workflows/modifygeometryvertexworkflow.js","webpack:///./workflows/movefeatureworkflow.js","webpack:///./workflows/steps/addfeaturestep.js","webpack:///./workflows/steps/addtablefeaturestep.js","webpack:///./workflows/steps/confirmstep.js","webpack:///./workflows/steps/deletefeaturestep.js","webpack:///./workflows/steps/editingstep.js","webpack:///./workflows/steps/linkrelationstep.js","webpack:///./workflows/steps/modifygeometryvertexstep.js","webpack:///./workflows/steps/movefeaturestep.js","webpack:///./workflows/steps/openformstep.js","webpack:///./workflows/steps/opentablestep.js","webpack:///./workflows/steps/pickfeaturestep.js","webpack:///./workflows/steps/tasks/addfeaturetabletask.js","webpack:///./workflows/steps/tasks/addfeaturetask.js","webpack:///./workflows/steps/tasks/confirmtask.js","webpack:///./workflows/steps/tasks/deletefeaturetask.js","webpack:///./workflows/steps/tasks/editingtask.js","webpack:///./workflows/steps/tasks/linkrelationtask.js","webpack:///./workflows/steps/tasks/modifygeometryvertextask.js","webpack:///./workflows/steps/tasks/movefeaturettask.js","webpack:///./workflows/steps/tasks/openformtask.js","webpack:///./workflows/steps/tasks/opentabletask.js","webpack:///./workflows/steps/tasks/pickfeaturetask.js"],"names":["t","g3wsdk","core","i18n","RelationService","require","MediaMixin","gui","vue","mixins","mediaMixin","maxSubsetLength","RelationComponent","Vue","extend","name","template","data","showallfieldsindex","tooltips","add_relation","link_relation","open_relation_tool","unlink_relation","value","placeholdersearch","methods","unlinkRelation","index","_service","addRelationAndLink","addRelation","startTool","relationtool","linkRelation","updateExternalKeyValueRelations","input","isRequired","relationAttributesSubset","relation","attributes","fields","relationsFields","forEach","field","_","isArray","push","label","end","Math","min","length","slice","relationsAttributesSubsetLength","relationFields","showAllRelationFields","showAllFieds","getRelationTools","getValue","constructor","Object","getFileName","split","pop","computed","relationsLength","relations","fieldrequired","enableAddLinkButtons","type","watch","showRelationStyle","nextTick","created","activated","mounted","formeventbus","$on","$nextTick","$","tooltip","relationsTable","DataTable","columnDefs","orderable","targets","hide","keyup","search","val","draw","destroyed","hideRelationStyle","module","exports","inherit","utils","base","FormComponent","EditingFormService","EditingFormComponent","options","relationsOptions","formEventBus","getService","getEventBus","service","RelationComponents","buildRelationComponents","hasRelations","addFormComponents","GUI","EdtingFormService","EditingService","state","_context","context","_inputs","inputs","_formEventBus","formLayer","layer","formFeature","features","isFather","getRelations","getArray","getRelationsInEditing","isNew","self","relationComponents","relationComponent","_relationsService","resourcesurl","getResourcesUrl","id","component","Plugin","plugin","i18nService","Service","EditingPanel","_Plugin","init","setService","config","getConfig","loadPlugin","on","registerPlugin","gid","ready","bind","setupGui","isBoolean","visible","toolsComponent","getComponent","toolsService","addTools","action","showEditingPanel","panel","showPanel","load","unload","clear","EditingComponent","EditingPanelComponent","title","toolboxes","XHR","WorkflowsStack","workflow","PluginService","CatalogLayersStoresRegistry","catalog","MapLayersStoreRegistry","map","LayersStore","Session","editing","Layer","serverErrorParser","errors","parsers","Server","ToolBoxesFactory","CommitFeaturesWorkflow","_sessions","toolboxselected","toolboxidactivetool","message","_mapService","interaction","getActiveTool","stop","_layersstore","queryable","addLayersStore","_editableLayers","Symbol","for","_toolboxes","layers","_getEditableLayersFromCatalog","editingLayersLenght","layerId","getId","editableLayer","getLayerForEditing","isReady","_checkLayerWidgets","setLayersColor","addLayers","getLayers","_buildToolBoxes","_createToolBoxDependencies","emit","proto","prototype","activeQueryInfo","activeMapControl","RELATIONS_COLOR","LAYERS_COLOR","color","childrenLayers","_layerChildrenRelationInEditing","splice","reverse","getColor","setColor","getLayerById","getChildren","childrenrealtioninediting","undoRelations","undoItems","session","toolbox","entries","toolboxId","items","getToolBoxById","getSession","undo","rollbackRelations","rollbackItems","rollback","redoRelations","redoItems","redo","getEditingLayer","build","addToolBox","getEditingFields","i","console","log","getLayer","setFather","dependencies","_getToolBoxEditingDependencies","hasDependencies","layerRelations","relationName","isFieldRequired","fieldName","relationLayers","merge","getFathers","toolboxesIds","filter","layerName","_hasEditingDependencies","handleToolboxDependencies","dependecyToolBox","getLayersDependencyFeatures","getDependencies","setEditing","EDITABLE","getCurrentWorflow","currentWorkFlow","getLast","getInputs","getContext","feature","getCurrentFeature","getRelationsAttributesByFeature","relationsattributes","getChild","getRelationsByFeature","getType","getFieldsWithValues","layerType","relationChildField","getChildField","relationFatherField","getFatherField","featureValue","isPk","get","editingLayer","getSource","getFeatures","readFeatures","_load","beforeEditingStart","Promise","resolve","reject","afterEditingStart","toolBox","getToolBoxes","getEditableLayers","_cancelOrSave","commitpromises","getHistory","commit","when","apply","always","refreshMap","setSelected","clearState","removeLayersStore","relationsinediting","relationinediting","getState","validate","valid","stopSessionChildren","relationLayerChildren","inEditing","fatherInEditing","relationLayerFathers","createEditingDataOptions","LayerTypes","VECTOR","bbox","getMapBBOX","children","relationChildLayers","isNil","startLoading","isStarted","start","stopLoading","editor","getEditor","err","_applyChangesToNewRelationsAfterCommit","relationsResponse","relationLayerId","response","sessionFeaturesStore","getFeaturesStore","featureStore","clone","setFeatures","applyCommitResponse","result","commitDirtyToolBoxes","isDirty","fail","revert","then","_createCommitMessage","commitItems","create_changes_list_dom_element","add","update","del","changeIds","join","dom","ids","delete","isEmpty","commits","close","d","Deferred","getCommitItems","dialog","getFontClass","closeButton","new_relations","notify","success","force","error","parser","parse","modal","promise","EDITING_FIELDS_TYPE","RELATIONTOOLS","default","_isExternalFieldRequired","_layerId","child","_layerType","_relationTools","_add_link_workflow","_checkIfExternalFieldRequired","_currentFeatureFatherFieldValue","fatherField","getCurrentWorkflow","getProperties","relationLayerType","getGeometryType","allrelationtools","icon","getEditingService","getTools","tool","concat","indexOf","cloneDeep","_originalLayerStyle","getStyle","_setAddLinkWorkflow","add_link_workflow","vector","link","table","_getLinkFeatureWorkflow","_getAddFeatureWorkflow","_highlightRelationSelect","geometryType","style","ol","Style","stroke","Stroke","width","image","Circle","radius","fill","Fill","setStyle","startVectorTool","startTableTool","featurestore","relationfeature","getFeatureById","setModal","_createWorkflowOptions","confirm","pushDelete","removeFeature","EditTableFeatureWorkflow","percContent","_bindEscKeyUp","output","_getRelationFieldsValue","_field","hideContent","_unbindEscKeyUp","_getRelationFeature","workflows","ModifyGeometryVertexWorkflow","MoveFeatureWorkflow","DeleteFeatureWorkflow","EditFeatureAttributesWorkflow","key","classworkflow","getOperator","startFromLastStep","outputs","father","childField","originalRelation","set","pushUpdate","_escKeyUpHandler","evt","keyCode","callback","document","unbind","one","_createRelationObj","_getRelationAsFatherStyleColor","fatherLayerStyle","fatherLayerStyleColor","getFill","getStroke","relationAlreadyLinked","rel","warning","featureId","workflow_options","excludeFields","fatherValue","getImage","opacity","originaRelation","getPk","editable","TableService","_features","_promise","_headers","headers","_fatherValue","_foreignKey","foreignKey","_workflow","isrelation","properties","save","cancel","deleteFeature","editFeature","pk","linkFeature","_setLayout","editing_table_content_height","height","height_70","Component","InternalComponent","$options","showValue","find","header","maxHeightTable","TableComponent","internalComponent","setInternalComponent","unmount","layout","G3WObject","Tool","_session","_layer","_op","op","enabled","active","messages","getMessages","startOp","once","tools","relationsChanges","setState","setId","getName","setActive","bool","isActive","getIcon","setIcon","setEnabled","isEnabled","setSession","getMessage","operator","getRunningStep","setMessage","clearMessage","EditToolsFactory","ToolBox","EditorToolBoxesFactory","TABLE","Geometry","geometry","AddFeatureWorkflow","EditTableFeaturesWorkflow","AddTableFeatureWorflow","EditorToolsFactory","buildTool","GeometryTypes","POINT","MULTIPOINT","LINESTRING","MULTILINESTRING","LINE","MULTILINE","POLYGON","MULTIPOLYGON","ToolComponent","props","toggletool","$emit","ToolsOfToolComponent","ToolboxComponent","showtoolsoftool","components","select","isLayerReady","selected","toggleEditing","layerstate","saveEdits","stopActiveTool","setActiveTool","toolId","toolhelpmessage","toolmessages","help","toolsoftool","Tools","snap","EditingTemplate","vueComponentOptions","transitions","restartActiveTool","saveAll","startToolBox","_getToolBoxById","stopToolBox","history","saveToolBox","_setActiveToolOfToolbooxSelected","getToolById","startActiveTool","_checkDirtyToolBoxes","setSelectedToolbox","isSelected","canCommit","canUndo","isNull","canRedo","PanelComponent","vueComponent","_resourcesUrl","resourcesUrl","mount","parent","EditingWorkflow","AddFeatureStep","OpenFormStep","AddFeatureWorflow","addfeaturestep","openformstep","snapTool","source","steps","AddTableFeatureStep","ConfirmStep","CommitFeatureWorflow","DeleteFeatureStep","DeleteFeatureWorflow","PickFeatureStep","Workflow","_toolsoftool","setToolsOfTool","getSteps","setSteps","EditTableFeatureWorflow","OpenTableStep","LinkRelationStep","LinkRelationWorflow","ModifyGeometryVertexStep","ModifyGeometryVertexWorflow","pickstep","modifyvertex","MoveFeatureStep","MoveFeatureWorflow","EditingStep","AddFeatureTask","task","Step","AddFeatureTableTask","ConfirmTask","DeleteFeatureTask","LinkRelationTask","ModifyGeometryVertexTask","MoveFeatureTask","OpenFormTask","OpenTableTask","PickFeatureTask","EditingTask","run","originalLayer","createNewFeature","pushAdd","addFeature","Feature","_busy","drawInteraction","_snap","_snapInteraction","_finishCondition","finishCondition","constant","_condition","condition","getEditingGeometryType","getFields","temporarySource","Vector","Draw","addInteraction","e","attribute","isPkEditable","setNew","setTemporaryId","removeInteraction","_removeLastPoint","removeLastPoint","Dialogs","fnc","buttons","SAVE","className","CANCEL","CLOSEMODAL","_dialog","DeleteInteraction","interactions","DeleteFeatureInteraction","_selectInteraction","geom","GeometryType","LINE_STRING","LINEAR_RING","MULTI_POINT","MULTI_LINE_STRING","MULTI_POLYGON","GEOMETRY_COLLECTION","CIRCLE","white","red","styles","zIndex","Infinity","originaLayer","Select","events","click","getGeometry","_deleteInteraction","relationsInEditing","updateRelation","relationService","relationLayer","required","remove","Task","PickFeatureInteraction","pickFeatureInteraction","_originalStyle","_feature","_deleteCondition","deleteCondition","undefined","originalFeature","newFeature","coordinates","getCoordinates","MultiPoint","Collection","_modifyInteraction","Modify","getExtent","removePoint","coordinate","_isNew","originalStyle","_translateInteraction","Translate","hitTolerance","isMobile","any","_formIdPrefix","_isContentChild","_originalLayer","_editingLayer","_layerName","_originalFeature","_pk","_fields","_editorFormStructure","_getFieldUniqueValuesFromServer","uniqueFields","fieldsName","getWidgetData","values","_getUniqueFieldsType","_getForm","getLength","exclude","getEditorFormStructure","showContentFactory","_cancelFnc","_saveFnc","setFieldsWithValues","startForm","formComponent","Form","formService","_generateFormId","dataid","isnew","formStructure","perc","showgoback","class","cbk","popContent","closeForm","content","showContent","closable","_tools"],"mappings":"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","file":"plugin.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","module.exports = \"<div style=margin-bottom:5px> <div class=\\\"box-header with-border\\\" style=margin-button:3px;background-color:#fff> <div class=container style=width:100%> <div class=row> <div class=col-sm-4 id=search-box> <input type=text class=form-control id=filterRelation :placeholder=placeholdersearch> </div> <div class=\\\"col-sm-2 pull-right\\\" style=padding:0> <span class=\\\"g3w-icon add-link pull-right\\\" align=center data-toggle=tooltip data-placement=bottom :title=tooltips.link_relation @click=\\\"enableAddLinkButtons ? linkRelation() : null\\\" :class=\\\"[{'disabled': !enableAddLinkButtons}, g3wtemplate.font['link']]\\\"> </span> <span data-toggle=tooltip data-placement=bottom :title=tooltips.add_relation @click=\\\"enableAddLinkButtons ? addRelationAndLink() : null\\\" class=\\\"g3w-icon add-link pull-right\\\" :class=\\\"[{'disabled' : !enableAddLinkButtons}, g3wtemplate.font['plus']]\\\"> </span> </div> </div> </div> </div> <div class=box-body style=padding:0> <template v-if=relationsLength> <table class=\\\"table g3wform-relation-table table-striped\\\" style=width:100%> <thead> <tr> <th v-for=\\\"attribute in relationAttributesSubset(relations[0])\\\"> {{attribute.label}} </th> <th></th> <th v-t=\\\"'tools'\\\"></th> </tr> </thead> <tbody> <tr v-for=\\\"(relation, index) in relations\\\" class=featurebox-header> <td v-show=!showAllFieds(index) v-for=\\\"attribute in relationAttributesSubset(relation)\\\"> <template v-if=\\\"isMedia(attribute.value) && getValue(attribute.value)\\\"> <div class=preview> <a :href=getValue(attribute.value) target=_blank> <div class=previewtype :class=getMediaType(attribute.value.mime_type).type> <i class=fa-2x :class=g3wtemplate.font[getMediaType(attribute.value.mime_type).type]></i> </div> </a> <div class=filename>{{ getFileName(attribute.value) }}</div> </div> </template> <span v-else>{{ getValue(attribute.value) }}</span> </td> <td class=action-cell> <div v-if=!fieldrequired class=\\\"g3w-mini-relation-icon g3w-icon\\\" :class=\\\"g3wtemplate.font['unlink']\\\" @click=unlinkRelation(index) data-toggle=tooltip data-placement=bottom :title=tooltips.unlink_relation aria-hidden=true> </div> </td> <td> <div style=display:flex> <div class=\\\"editbtn enabled\\\" @click=\\\"startTool(relationtool, index)\\\" v-for=\\\"relationtool in getRelationTools()\\\" :key=relationtool.state.name data-toggle=tooltip data-placement=bottom :title=relationtool.state.name> <img height=20px width=20px :src=\\\"resourcesurl + 'images/'+ relationtool.state.icon\\\"/> </div> </div> </td> </tr> </tbody> </table> </template> </div> </div> \";","const t = g3wsdk.core.i18n.t;\nconst RelationService = require('../../../../services/relationservice');\nconst MediaMixin = g3wsdk.gui.vue.mixins.mediaMixin;\nconst maxSubsetLength = 5;\n\n RelationComponent = Vue.extend({\n  mixins: [MediaMixin],\n  name: 'g3w-relation',\n  template: require('./relation.html'),\n  data: function() {\n    return {\n      showallfieldsindex: null,\n      tooltips: {\n        add_relation: t(\"form.relations.tooltips.add_relation\"),\n        link_relation: t(\"form.relations.tooltips.link_relation\"),\n        open_relation_tool: t(\"form.relations.tooltips.open_relation_tools\"),\n        unlink_relation: t(\"form.relations.tooltips.unlink_relation\")\n      },\n      value: null,\n      placeholdersearch: `${t('dosearch')} ...`\n    }\n  },\n  methods: {\n    unlinkRelation: function(index) {\n      this._service.unlinkRelation(index)\n    },\n    addRelationAndLink: function() {\n      this._service.addRelation();\n    },\n    startTool: function(relationtool, index) {\n      this._service.startTool(relationtool, index)\n    },\n    linkRelation: function() {\n      this._service.linkRelation();\n    },\n    updateExternalKeyValueRelations: function(input) {\n      this._service.updateExternalKeyValueRelations(input);\n    },\n    isRequired: function() {\n      return this._service.isRequired();\n    },\n    relationAttributesSubset: function(relation) {\n      let attributes = [];\n      const fields = this.relationsFields(relation);\n      fields.forEach((field) => {\n        if (_.isArray(field.value)) return;\n        attributes.push({label: field.label, value: field.value})\n      });\n      const end = Math.min(maxSubsetLength, attributes.length);\n      return attributes.slice(0, end);\n    },\n    relationsAttributesSubsetLength: function(relation) {\n      return this.relationAttributesSubset(relation).length;\n    },\n    relationsFields: function(relation) {\n      let attributes = this._service.relationFields(relation);\n      return attributes;\n    },\n    showAllRelationFields: function(index) {\n      this.showallfieldsindex = this.showallfieldsindex == index ? null : index;\n    },\n    showAllFieds: function(index) {\n      return this.showallfieldsindex == index;\n    },\n    getRelationTools: function() {\n      return this._service.getRelationTools();\n    },\n    getValue(value) {\n      if (value && typeof  value === 'object' && value.constructor === Object) {\n        value = value.value;\n      }\n      this.value = value;\n      return value;\n    },\n    getFileName(value) {\n      return this.getValue(value).split('/').pop();\n    }\n  },\n  computed: {\n    relationsLength: function() {\n      return this.relations.length;\n    },\n    fieldrequired: function() {\n      return this._service.isRequired();\n    },\n    enableAddLinkButtons: function() {\n      return !this.relations.length || (this.relations.length && this.relation.type != 'ONE');\n    }\n  },\n  watch: {\n    // vado a verificare lo state\n    'relations': function() {\n      this._service.showRelationStyle();\n      Vue.nextTick(function() {\n        // con l'aggiunta di relazioni vado a fare il nano scroll\n      })\n    }\n  },\n  created: function() {\n    //vado a settare il servizio\n    this._service = new RelationService({\n      relation: this.relation,\n      relations: this.relations\n    })\n  },\n  activated() {},\n  mounted: function() {\n    this._service.showRelationStyle();\n    this.formeventbus.$on('changeinput', this.updateExternalKeyValueRelations);\n    this.$nextTick(() => {\n      $('.g3w-icon[data-toggle=\"dropdown\"]').tooltip();\n      const relationsTable = $('.g3wform-relation-table').DataTable({\n        \"scrollX\": true,\n        \"order\": [ 0, 'asc' ],\n        columnDefs: [\n          { orderable: false, targets: [-1, -2, -3] }\n        ]\n      });\n      $(\".dataTables_filter, .dataTables_length\").hide();\n      $('#filterRelation').keyup(function() {\n        relationsTable.search($(this).val()).draw() ;\n      })\n    })\n    //this.formeventbus.$emit('addtovalidate', this.validate);\n  },\n  destroyed: function() {\n    this._service.hideRelationStyle();\n  }\n });\n\n\nmodule.exports = RelationComponent;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst FormComponent = g3wsdk.gui.vue.FormComponent;\nconst EditingFormService = require('./editingformservice');\n\nfunction EditingFormComponent(options={}) {\n  base(this, options);\n  // solo tutte le informazini relative alle relazioni di quella toolbox/layer\n  const relationsOptions = options.relationsOptions;\n  // recuprare l'event bus del form\n  relationsOptions.formEventBus = this.getService().getEventBus();\n  // vado a creare il servizio delle relazioni\n  const service = new EditingFormService(relationsOptions);\n  // mi restituisce il componente Vue da passare al form\n  const RelationComponents = service.buildRelationComponents();\n  // qui vado ad aggiungere il componente relations\n  if (service.hasRelations())\n    this.addFormComponents(RelationComponents);\n\n}\n\ninherit(EditingFormComponent, FormComponent);\n\nmodule.exports = EditingFormComponent;\n","const GUI = g3wsdk.gui.GUI;\nconst t = g3wsdk.core.i18n.t;\nconst RelationComponent = require('./components/relation/vue/relation');\nconst EdtingFormService = function(options={}) {\n  const EditingService = require('../services/editingservice');\n  this.state = {\n    relations: []\n  };\n  // riceve il context del form principale\n  this._context = options.context || {};\n  // riceve gli inpust del form principale\n  this._inputs = options.inputs || {};\n  // riceve l'event bus del form pricipale\n  this._formEventBus = options.formEventBus || null;\n  // sono le relazioni effettive presenti\n  let relations = [];\n  const formLayer = this._context.layer;\n  const formFeature = this._inputs.features[this._inputs.features.length - 1];\n  if (formLayer.isFather()) {\n    // recupero l'array delle relazioni\n    relations = formLayer.getRelations().getArray();\n    // vado a filtrare le relazioni per quelle che son o effettivamente in editing\n    relations = EditingService.getRelationsInEditing(relations, formFeature, formFeature.isNew());\n    // le relazioni in questione sono oggetti Realtion che contengono le informazioni nello stato delle composizione della relazione\n  }\n  this.hasRelations = function() {\n    return !!relations.length;\n  };\n  // funzione che mi serve per costruire il componente vue da innestare dentro il form\n  // come componente relations\n  this.buildRelationComponents = function() {\n    const self = this;\n    const relationComponents = [];\n    for (const relation of relations) {\n      const relationComponent = Vue.extend({\n        mixins: [RelationComponent],\n        name: relation.relation.name,\n        methods: {\n          getService: function() {\n            return self._relationsService;\n          }\n        },\n        data: function() {\n          return {\n            relation: relation.relation,\n            relations: relation.relations,\n            resourcesurl: GUI.getResourcesUrl(),\n            formeventbus: self._formEventBus\n          }\n        }\n      });\n      relationComponents.push({\n        id: `${t(\"editing.edit_relation\")} ${relation.relation.name}`,\n        component: relationComponent\n      })\n    }\n    return relationComponents;\n  };\n};\n\nmodule.exports =  EdtingFormService;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base = g3wsdk.core.utils.base;\nconst Plugin = g3wsdk.core.plugin.Plugin;\nconst GUI = g3wsdk.gui.GUI;\nconst i18nService = g3wsdk.core.i18n;\nconst Service = require('./services/editingservice');\nconst EditingPanel = require('./panel');\n\nconst _Plugin = function() {\n  base(this);\n  this.name = 'editing';\n  this.init = function() {\n    this.setService(Service);\n    this.config = this.getConfig();\n    // check if exist any layer to edit\n    if (this.service.loadPlugin()) {\n      //inizialize service\n      this.service.init(this.config);\n      this.service.on('ready', () => {\n        //plugin registry\n        if (this.registerPlugin(this.config.gid)) {\n          if (!GUI.ready) {\n            GUI.on('ready',_.bind(this.setupGui, this));\n          } else {\n            this.setupGui();\n          }\n        }\n      })\n    }\n  };\n  //setup plugin interface\n  this.setupGui = function() {\n    if (_.isBoolean(this.config.visible) && !this.config.visible)\n      return false;\n    let toolsComponent = GUI.getComponent('tools');\n    let toolsService = toolsComponent.getService();\n    toolsService.addTools(0, 'EDITING', [{\n      name: i18nService.t(\"editing_data\"),\n      action: _.bind(this.showEditingPanel, this)\n    }])\n  };\n\n  //method to show editing panel\n  this.showEditingPanel = function() {\n    const panel = new EditingPanel();\n    GUI.showPanel(panel);\n  };\n\n  this.load = function() {\n    this.init();\n  };\n\n  this.unload = function() {\n    this.service.clear()\n  }\n};\n\ninherit(_Plugin, Plugin);\n\n(function(plugin){\n  plugin.init();\n})(new _Plugin);\n\n","var base = g3wsdk.core.utils.base;\nvar inherit = g3wsdk.core.utils.inherit;\nvar i18nService = g3wsdk.core.i18n;\nvar EditingComponent = require('./vue/editing');\n\nfunction EditingPanelComponent(options) {\n  options = options || {};\n  // editortoolsbars\n  options.id = \"editing-panel\";\n  options.title = i18nService.t(\"editing_data\");\n  options.name = \"Gestione dati EDITING\";\n  options.toolboxes = options.toolboxes || null;\n  base(this, options)\n}\n\ninherit(EditingPanelComponent, EditingComponent);\n\nmodule.exports = EditingPanelComponent;\n\n\n","const inherit = g3wsdk.core.utils.inherit;\nconst XHR = g3wsdk.core.utils.XHR;\nconst base =  g3wsdk.core.utils.base;\nconst WorkflowsStack = g3wsdk.core.workflow.WorkflowsStack;\nconst PluginService = g3wsdk.core.plugin.PluginService;\nconst CatalogLayersStoresRegistry = g3wsdk.core.catalog.CatalogLayersStoresRegistry;\nconst MapLayersStoreRegistry = g3wsdk.core.map.MapLayersStoreRegistry;\nconst LayersStore = g3wsdk.core.layer.LayersStore;\nconst Session = g3wsdk.core.editing.Session;\nconst Layer = g3wsdk.core.layer.Layer;\nconst GUI = g3wsdk.gui.GUI;\nconst serverErrorParser= g3wsdk.core.errors.parsers.Server;\nconst ToolBoxesFactory = require('../toolboxes/toolboxesfactory');\nconst t = g3wsdk.core.i18n.t;\nconst CommitFeaturesWorkflow = require('../workflows/commitfeaturesworkflow');\n\nfunction EditingService() {\n  base(this);\n  // contains alla sessions\n  this._sessions = {};\n  // state of editing\n  this.state = {\n    toolboxes: [], // contiene tutti gli stati delle toolbox in editing\n    toolboxselected: null, // tiene riferimento alla toolbox selezionata\n    toolboxidactivetool: null,\n    message: null, // messaggio genarle del pannello di editing\n    relations: [] // relazioni\n  };\n  //mapservice\n  this._mapService = GUI.getComponent('map').getService();\n  // disable active tool on wehena a control is activated\n  this._mapService.on('mapcontrol:active', (interaction) => {\n    let toolboxselected = this.state.toolboxselected;\n    if ( toolboxselected && toolboxselected.getActiveTool()) {\n      toolboxselected.getActiveTool().stop();\n    }\n  });\n  // prendo tutti i layers del progetto corrente che si trovano\n  // all'interno dei Layerstore del catalog registry con caratteristica editabili.\n  // Mi verranno estratti tutti i layer editabili anche quelli presenti nell'albero del catalogo\n  // come per esempio il caso di layers relazionati\n  this.init = function(config) {// layersStore del plugin editing che conterrà tutti i layer di editing\n    this._layersstore = new LayersStore({\n      id: 'editing',\n      queryable: false // lo setto a false così che quando faccio la query (controllo) non prendo anche questi\n    });\n    //add edting layer store to mapstoreregistry\n    MapLayersStoreRegistry.addLayersStore(this._layersstore);\n    // setto la configurazione del plugin\n    this.config = config;\n    // oggetto contenente tutti i layers in editing\n    this._editableLayers = {\n      [Symbol.for('layersarray')]: []\n    };\n    // contiene tutti i toolbox\n    this._toolboxes = [];\n    // restto\n    this.state.toolboxes = [];\n    // sono i layer originali caricati dal progetto e messi nel catalogo\n    let layers = this._getEditableLayersFromCatalog();\n    let editingLayersLenght = layers.length;\n    //ciclo su ogni layers editiabile\n    for (const layer of layers) {\n      const layerId = layer.getId();\n      this._editableLayers[layerId] = {};\n      // vado a chiamare la funzione che mi permette di\n      // estrarre la versione editabile del layer di partenza (es. da imagelayer a vector layer, table layer/tablelayer etc..)\n      const editableLayer = layer.getLayerForEditing();\n      if (editableLayer.isReady()) {\n        editingLayersLenght-=1;\n        this._checkLayerWidgets(editableLayer);\n      }\n      editableLayer.on('layer-config-ready', () => {\n        this._checkLayerWidgets(editableLayer);\n        editingLayersLenght-=1;\n        if (editingLayersLenght === 0) {\n          // set toolbox colors\n          this.setLayersColor();\n          // after sadd layers to layerstore\n          this._layersstore.addLayers(this.getLayers());\n          // vado a creare i toolboxes\n          this._buildToolBoxes();\n          // create a dependencies tree\n          this._createToolBoxDependencies();\n          this.emit('ready');\n        }\n      });\n      // vado ad aggiungere ai layer editabili\n      this._editableLayers[layerId] = editableLayer;\n      this._editableLayers[Symbol.for('layersarray')].push(editableLayer);\n      // aggiungo all'array dei vectorlayers se per caso mi servisse\n      this._sessions[layerId] = null;\n    }\n  }\n}\n\ninherit(EditingService, PluginService);\n\nlet proto = EditingService.prototype;\n\nproto.activeQueryInfo = function() {\n  this._mapService.activeMapControl('query');\n};\n\n\nproto.setLayersColor = function() {\n\n  const RELATIONS_COLOR = [\n    [\"#656F94\",\n      \"#485584\",\n      \"#303E73\",\n      \"#1B2B63\",\n      \"#0C1B53\"],\n\n    [\"#CF858F\",\n      \"#B95A67\",\n      \"#A23645\",\n      \"#8B1929\",\n      \"#740313\"],\n\n    [\"#86B976\",\n      \"#64A450\",\n      \"#479030\",\n      \"#2F7C16\",\n      \"#1B6803\"],\n\n    [\"#DAC28C\",\n      \"#C2A45E\",\n      \"#AA8739\",\n      \"#926E1A\",\n      \"#7A5603\"]\n  ];\n\n  const LAYERS_COLOR = [\n    \"#AFEE30\",\n    \"#96C735\",\n    \"#7B9F35\",\n    \"#5F772F\",\n    \"#414F25\",\n\n    \"#4138B2\",\n    \"#3E3794\",\n    \"#373276\",\n    \"#2E2B59\",\n    \"#22203B\",\n\n    \"#FFD033\",\n    \"#D5B139\",\n    \"#AA9039\",\n    \"#7F6E33\",\n    \"#544A27\",\n\n    \"#CD2986\",\n    \"#AB2E74\",\n    \"#882D61\",\n    \"#66294B\",\n    \"#431F34\"\n  ];\n  let color;\n  let childrenLayers;\n  for (const layer of this.getLayers()) {\n    // verifico se è un layer è padre e se ha figli in editing\n    childrenLayers = this._layerChildrenRelationInEditing(layer);\n    if (layer.isFather() && childrenLayers.length) {\n      color = RELATIONS_COLOR.splice(0,1).pop().reverse();\n      !layer.getColor() ? layer.setColor(color.splice(0,1).pop()): null;\n      childrenLayers.forEach((layerId) => {\n        const layer = this.getLayerById(layerId);\n        !layer.getColor() ? layer.setColor(color.splice(0,1).pop()): null;\n      });\n    }\n  }\n  for (const layer of this.getLayers()) {\n    !layer.getColor() ? layer.setColor(LAYERS_COLOR.splice(0,1).pop()): null;\n  }\n};\n\nproto._layerChildrenRelationInEditing = function(layer) {\n  let relations = layer.getChildren();\n  let childrenrealtioninediting = [];\n  relations.forEach((relation) => {\n    if (this.getLayerById(relation))\n      childrenrealtioninediting.push(relation);\n  });\n  return childrenrealtioninediting;\n};\n\n// udo delle relazioni\nproto.undoRelations = function(undoItems) {\n  let session;\n  let toolbox;\n  Object.entries(undoItems).forEach(([toolboxId, items]) => {\n    toolbox = this.getToolBoxById(toolboxId);\n    session = toolbox.getSession();\n    session.undo(items);\n  })\n};\n\n// undo delle relazioni\nproto.rollbackRelations = function(rollbackItems) {\n  let session;\n  let toolbox;\n  Object.entries(rollbackItems).forEach(([toolboxId, items]) => {\n    toolbox = this.getToolBoxById(toolboxId);\n    session = toolbox.getSession();\n    session.rollback(items);\n  })\n};\n\n// redo delle relazioni\nproto.redoRelations = function(redoItems) {\n  let session;\n  let toolbox;\n  Object.entries(redoItems).forEach(([toolboxId, items]) => {\n    toolbox = this.getToolBoxById(toolboxId);\n    session = toolbox.getSession();\n    session.redo(items);\n  })\n};\n\n// restituisce il layer che viene utilizzato dai task per fare le modifiche\n// ol.vector nel cso dei vettoriali, tableLayer nel caso delle tabelle\nproto.getEditingLayer = function(id) {\n  let toolbox = this.getToolBoxById(id);\n  return toolbox.getEditingLayer();\n};\n\nproto._buildToolBoxes = function() {\n  for (const layer of this.getLayers()) {\n    // la toolboxes costruirà il toolboxex adatto per quel layer\n    // assegnadogli le icone dei bottonii etc ..\n    const toolbox = ToolBoxesFactory.build(layer);\n    // vado ad aggiungere la toolbox\n    this.addToolBox(toolbox);\n  }\n};\n\n//funzione che server per aggiungere un editor\nproto.addToolBox = function(toolbox) {\n  this._toolboxes.push(toolbox);\n  // vado ad aggiungere la sessione\n  this._sessions[toolbox.getId()] = toolbox.getSession();\n  this.state.toolboxes.push(toolbox.state);\n};\n\nproto._checkLayerWidgets = function(layer) {\n  const fields = layer.getEditingFields();\n  for (let i=0; i < fields.length; i++) {\n    console.log(fields[i].input.type)\n  }\n  //console.log(EditingService.EDITING_FIELDS_TYPE)\n};\n\n// funzione che crea le dipendenze\nproto._createToolBoxDependencies = function() {\n  this._toolboxes.forEach((toolbox) => {\n    const layer = toolbox.getLayer();\n    toolbox.setFather(layer.isFather());\n    toolbox.state.editing.dependencies = this._getToolBoxEditingDependencies(layer);\n    if (layer.isFather() && toolbox.hasDependencies() ) {\n      const layerRelations = layer.getRelations().getRelations();\n      for (const relationName in layerRelations) {\n        const relation = layerRelations[relationName];\n        toolbox.addRelation(relation);\n      }\n    }\n  })\n};\n\nproto.isFieldRequired = function(layerId, fieldName) {\n  return this.getLayerById(layerId).isFieldRequired(fieldName);\n};\n\nproto._getToolBoxEditingDependencies = function(layer) {\n  let relationLayers = _.merge(layer.getChildren(), layer.getFathers());\n  let toolboxesIds = relationLayers.filter((layerName) => {\n    return !!this.getLayerById(layerName);\n  });\n  return toolboxesIds;\n};\n\n// verifico se le sue diendenza sono legate a layer effettivamente in editing o no\nproto._hasEditingDependencies = function(layer) {\n  let toolboxesIds = this._getToolBoxEditingDependencies(layer);\n  return !!toolboxesIds.length;\n};\n\n// funzione che serve a manageggia\nproto.handleToolboxDependencies = function(toolbox) {\n  let dependecyToolBox;\n  if (toolbox.isFather())\n  // verifico se le feature delle dipendenze sono state caricate\n    this.getLayersDependencyFeatures(toolbox.getId());\n  toolbox.getDependencies().forEach((toolboxId) => {\n    dependecyToolBox = this.getToolBoxById(toolboxId);\n    // disabilito visivamente l'editing\n    dependecyToolBox.setEditing(false);\n  })\n};\n\nproto._getEditableLayersFromCatalog = function() {\n  let layers = CatalogLayersStoresRegistry.getLayers({\n    EDITABLE: true\n  });\n  return layers;\n};\n\nproto.getLayers = function() {\n  return this._editableLayers[Symbol.for('layersarray')];\n};\n\nproto.getCurrentWorflow = function() {\n  let currentWorkFlow = WorkflowsStack.getLast();\n  return {\n    session: currentWorkFlow.getSession(),\n    inputs: currentWorkFlow.getInputs(),\n    context: currentWorkFlow.getContext(),\n    feature: currentWorkFlow.getCurrentFeature(),\n    layer: currentWorkFlow.getLayer()\n  };\n};\n\nproto.getRelationsAttributesByFeature = function(relation, feature) {\n  let relationsattributes = [];\n  let toolboxId = relation.getChild();\n  let layer = this.getToolBoxById(toolboxId).getLayer();\n  let relations = this.getRelationsByFeature(relation, feature, layer.getType());\n  let fields;\n  relations.forEach((relation) => {\n    fields = layer.getFieldsWithValues(relation);\n    relationsattributes.push({\n      fields: fields,\n      id: relation.getId()\n    });\n  });\n  return relationsattributes;\n};\n\nproto.getRelationsByFeature = function(relation, feature, layerType) {\n  let toolboxId = relation.getChild();\n  let relationChildField = relation.getChildField();\n  let relationFatherField= relation.getFatherField();\n  let featureValue = feature.isPk(relationFatherField) ? feature.getId() : feature.get(relationFatherField);\n  let toolbox = this.getToolBoxById(toolboxId);\n  let editingLayer = toolbox.getEditingLayer();\n  let features = layerType == 'vector' ? editingLayer.getSource().getFeatures() : editingLayer.getSource().readFeatures() ;\n  let relations = [];\n  features.forEach((feature) => {\n    if (feature.get(relationChildField) == featureValue) {\n      relations.push(feature);\n    }\n  });\n  return relations;\n};\n\nproto.loadPlugin = function() {\n  return this._load = !!this._getEditableLayersFromCatalog().length; // mi dice se ci sono layer in editing e quindi da caricare il plugin\n};\n\n// funzione che restituisce l'editing layer estratto dal layer del catalogo\n// vectorLayer lel caso di un imageLayere e tablelayer  nel cso di un table lauer\nproto.getLayerById = function(layerId) {\n  return this._editableLayers[layerId];\n};\n\nproto.beforeEditingStart = function({id}= {}) {\n  return new Promise((resolve, reject) => {\n    resolve()\n  })\n};\n\nproto.afterEditingStart = function({id}= {}) {\n  return new Promise((resolve, reject) => {\n    resolve()\n  })\n};\n\n// vado a recuperare il toolbox a seconda del suo id\nproto.getToolBoxById = function(toolboxId) {\n  let toolBox = null;\n  this._toolboxes.forEach((toolbox) => {\n    if (toolbox.getId() == toolboxId) {\n      toolBox = toolbox;\n      return false;\n    }\n  });\n  return toolBox;\n};\n\nproto.getToolBoxes = function() {\n  return this._toolboxes;\n};\n\nproto.getEditableLayers = function() {\n  return this._editableLayers;\n};\n\nproto._cancelOrSave = function(){\n  return resolve();\n};\n\nproto.stop = function() {\n  return new Promise((resolve, reject) => {\n    let commitpromises = [];\n    // vado a chiamare lo stop di ogni toolbox\n    this._toolboxes.forEach((toolbox) => {\n      // vado a verificare se c'è una sessione sporca e quindi\n      // chiedere se salvare\n      if (toolbox.getSession().getHistory().state.commit) {\n        // ask to commit before exit, sdet true to close\n        commitpromises.push(this.commit(toolbox, true));\n      }\n    });\n    // prima di stoppare tutto e chidere panello\n    $.when.apply(this, commitpromises)\n      .always(() => {\n        this._mapService.refreshMap();\n        this._toolboxes.forEach((toolbox) => {\n          // vado a stoppare tutti le toolbox\n          toolbox.stop();\n          // vado a deselzionare eventuali toolbox\n          toolbox.setSelected(false);\n        });\n        this.clearState();\n        resolve();\n    });\n  });\n};\n\n// remove Editing LayersStore\nproto.clear = function() {\n  MapLayersStoreRegistry.removeLayersStore(this._layersstore);\n};\n\nproto.clearState = function() {\n  this.state.toolboxselected = null; // tiene riferimento alla toolbox selezionata\n  this.state.toolboxidactivetool =  null;\n  this.state.message =  null; // messaggio genarle del pannello di editing\n};\n\n// funzione che filtra le relazioni in base a quelle presenti in editing\nproto.getRelationsInEditing = function(relations, feature, isNew) {\n  let relationsinediting = [];\n  let relationinediting;\n  relations.forEach((relation) => {\n    if (this.getLayerById(relation.getChild())) {\n      // aggiungo lo state della relazione\n      relationinediting = {\n        relation:relation.getState(),\n        relations: this.getRelationsAttributesByFeature(relation, feature) // le relazioni esistenti\n      };\n      relationinediting.validate = {\n        valid:true\n      };\n      relationsinediting.push(relationinediting);\n    }\n  });\n  return relationsinediting;\n};\n\n// qui devo verificare sia l condizione del padre che del figlio\nproto.stopSessionChildren = function(layerId) {\n  // caso padre verifico se i figli sono in editing o meno\n  let relationLayerChildren = this.getLayerById(layerId).getChildren();\n  let toolbox;\n  relationLayerChildren.forEach((id) => {\n    toolbox = this.getToolBoxById(id);\n    if (toolbox && !toolbox.inEditing())\n      this._sessions[id].stop();\n  });\n};\n\nproto.fatherInEditing = function(layerId) {\n  let inEditing = false;\n  let toolbox;\n  // caso padre verifico se ci sono padri in editing o meno\n  let relationLayerFathers = this.getLayerById(layerId).getFathers();\n  relationLayerFathers.forEach((id) => {\n    toolbox = this.getToolBoxById(id);\n    if (toolbox && toolbox.inEditing()) {\n      inEditing = true;\n      return false;\n    }\n  });\n  return inEditing;\n};\n\n// prendo come opzione il tipo di layer\nproto.createEditingDataOptions = function(layerType) {\n  let options = {\n    editing: true,\n    type: layerType\n  };\n  // verifico se layer vettoriale\n  if(layerType == Layer.LayerTypes.VECTOR) {\n    // aggiungo il filto bbox\n    let bbox = this._mapService.getMapBBOX();\n    options.filter = {\n      bbox: bbox\n    }\n  }\n  // ritorno opzione\n  return options\n};\n\n// fa lo start di tutte le dipendenze del layer legato alla toolbox che si è avviato\nproto.getLayersDependencyFeatures = function(layerId) {\n  // vado a recuperare le relazioni (figli al momento) di quel paricolare layer\n  /*\n   IMPORTANTE: PER EVITARE PROBLEMI È IMPORTANTE CHE I LAYER DIPENDENTI SIANO A SUA VOLTA EDITABILI\n   */\n  let children = this.getLayerById(layerId).getChildren();\n  let relationChildLayers = children.filter((id) => {\n    return !!this.getLayerById(id);\n  });\n  // se ci sono layer figli dipendenti\n  if (!_.isNil(relationChildLayers) && relationChildLayers.length) {\n    /*\n     * qui andrò a verificare se stata istanziata la sessione altrimenti vienne creata\n     * se la sessione è attiva altrimenti viene attivata\n     * */\n    //cerco prima tra i toolbox se presente\n    let session;\n    let toolbox;\n    let options;\n    // cliclo sulle dipendenze create\n    relationChildLayers.forEach((id) => {\n      options = this.createEditingDataOptions(this.getLayerById(id).getType());\n      session = this._sessions[id];\n      toolbox = this.getToolBoxById(id);\n      //setto la proprietà a loading\n      toolbox.startLoading();\n      //verifico che ci sia la sessione\n      if (session) {\n        if (!session.isStarted()) {\n          session.start(options)\n            .always(() => {\n              // setto la proprià a stop loading sempre\n              toolbox.stopLoading();\n            })\n        } else {\n          session.getFeatures(options)\n            .always(() => {\n              toolbox.stopLoading();\n            })\n        }\n      } else {\n        // altrimenti per quel layer la devo instanziare\n        try {\n          let layer = this._layersstore.getLayerById(id);\n          let editor = layer.getEditor();\n          session = new Session({\n            editor: editor\n          });\n          this._sessions[id] = session;\n          session.start();\n        }\n        catch(err) {\n          console.log(err);\n        }\n      }\n    })\n  }\n};\n\nproto._applyChangesToNewRelationsAfterCommit = function(relationsResponse) {\n  for (relationLayerId in relationsResponse) {\n    const response = relationsResponse[relationLayerId];\n    const layer = this.getLayerById(relationLayerId);\n    const sessionFeaturesStore = this.getToolBoxById(relationLayerId).getSession().getFeaturesStore();\n    const featureStore = layer.getSource();\n    const features = _.clone(sessionFeaturesStore.readFeatures());\n    features.forEach((feature) => {\n      feature.clearState();\n    });\n    featureStore.setFeatures(features);\n    layer.applyCommitResponse({\n      response,\n      result: true\n    });\n  }\n};\n\nproto.commitDirtyToolBoxes = function(toolboxId) {\n  return new Promise((resolve, reject) => {\n    let toolbox = this.getToolBoxById(toolboxId);\n    if (toolbox.isDirty() && toolbox.hasDependencies()) {\n      this.commit(toolbox)\n        .fail(() => {\n          toolbox.revert()\n            .then(() => {\n              // se ha dipendenze vado a fare il revert delle modifiche fatte\n              toolbox.getDependencies().forEach((toolboxId) => {\n                this.getToolBoxById(toolboxId).revert();\n              })\n            })\n        })\n        .always(() => {\n          resolve(toolbox);\n        })\n    } else\n      resolve(toolbox);\n  });\n};\n\nproto._createCommitMessage = function(commitItems) {\n  function create_changes_list_dom_element(add, update, del) {\n    const changeIds = {};\n    changeIds[`${t('editing.messages.commit.add')}`] = _.map(add, 'id').join(',');\n    changeIds[`${t('editing.messages.commit.update')}`] = _.map(update, 'id').join(',');\n    changeIds[`${t('editing.messages.commit.delete')}`] = del.join(',');\n    let dom = \"<ul style='border-bottom-color: #f4f4f4;'>\";\n    Object.entries(changeIds).forEach(([action, ids]) => {\n      dom += \"<li>\" + action + \": [\" + ids + \"]</li>\";\n    });\n    dom += \"</ul>\";\n    return dom;\n  }\n\n  let message = \"\";\n  message += create_changes_list_dom_element(commitItems.add, commitItems.update, commitItems.delete);\n  if (!_.isEmpty(commitItems.relations)) {\n    message += \"<div style='height:1px; background:#f4f4f4;border-bottom:1px solid #f4f4f4;'></div>\";\n    message += \"<div style='margin-left: 40%'><h4>Relazioni</h4></div>\";\n    Object.entries(commitItems.relations).forEach(([ relationName, commits]) => {\n      message +=  \"<div><span style='font-weight: bold'>\" + relationName + \"</span></div>\";\n      message += create_changes_list_dom_element(commits.add, commits.update, commits.delete);\n    })\n  }\n  return message;\n};\n\nproto.commit = function(toolbox, close=false) {\n  let d = $.Deferred();\n  toolbox = toolbox || this.state.toolboxselected;\n  let session = toolbox.getSession();\n  let layer = toolbox.getLayer();\n  const layerType = layer.getType();\n  let workflow = new CommitFeaturesWorkflow({\n    type:  'commit'\n  });\n  workflow.start({\n    inputs: {\n      layer: layer,\n      message: this._createCommitMessage(session.getCommitItems()),\n      close: close\n    }})\n    .then(() => {\n      const dialog = GUI.dialog.dialog({\n        message: `<h4 class=\"text-center\"><i style=\"margin-right: 5px;\" class=${GUI.getFontClass('spinner')}></i>${t('editing.messages.saving')}</h4>`,\n        closeButton: false\n      });\n\n      // funzione che serve a fare il commit della sessione legata al tool\n      // qui probabilmente a seconda del layer se ha dipendenze faccio ogni sessione\n      // produrrà i suoi dati post serializzati che poi saranno uniti per un unico commit\n      session.commit()\n        .then( (commitItems, response) => {\n          if (response.result) {\n            let relationsResponse = response.response.new_relations;\n            if (relationsResponse) {\n              this._applyChangesToNewRelationsAfterCommit(relationsResponse);\n            }\n            GUI.notify.success(t(\"editing.messages.saved\"));\n            if (layerType === 'vector')\n              this._mapService.refreshMap({force: true});\n          } else {\n            const message = response.errors;\n            GUI.notify.error(message);\n          }\n          workflow.stop();\n          d.resolve(toolbox);\n        })\n        .fail( (error) => {\n          let parser = new serverErrorParser({\n            error: error\n          });\n          let message = parser.parse();\n          GUI.notify.error(message);\n          workflow.stop();\n          d.resolve(toolbox);\n        })\n        .always(() => {\n          dialog.modal('hide');\n        })\n    })\n    .fail(() => {\n      workflow.stop();\n      d.reject(toolbox);\n    });\n  return d.promise();\n};\n\nEditingService.EDITING_FIELDS_TYPE = ['unique'];\n\n\nmodule.exports = new EditingService;\n","const GUI = g3wsdk.gui.GUI;\nconst t = g3wsdk.core.i18n.t;\n\n// what we can do with each type of relation element\nconst RELATIONTOOLS = {\n  default: ['editattributes', 'deletefeature'],\n  'table' : [],\n  'Point': ['movefeature'],\n  'LineString': ['movevertex'],\n  'Polygon': ['movefeature', 'movevertex']\n};\n\n// servizio che in base alle relazioni (configurazione)\nconst RelationService = function(options = {}) {\n  this.relation = options.relation;\n  this.relations = options.relations;\n  this._isExternalFieldRequired = false;\n  this._layerId = this.relation.child;\n  this._layerType = this.getLayer().getType();\n  this._relationTools = [];\n  this._add_link_workflow = null; // sono i workflow link e adda che verranmno settati in base al tipo di layer\n  this._isExternalFieldRequired = this._checkIfExternalFieldRequired();\n  // prendo il valore del campo se esiste come proprietà altrimenti prendo il valore della chiave primaria\n  this._currentFeatureFatherFieldValue = this.relation.fatherField in this.getCurrentWorkflow().feature.getProperties() ? this.getCurrentWorkflow().feature.get(this.relation.fatherField) : this.getCurrentWorkflow().feature.getId();\n  //get type of relation\n  const relationLayerType = this.getLayer().getType() == 'vector' ? this.getLayer().getGeometryType() : 'table';\n  let allrelationtools;\n  if (relationLayerType == 'table') {\n    this._relationTools.push({\n      state: {\n        icon: 'deleteTableRow.png',\n        id: 'deletefeature',\n        name: t(\"editing.tools.delete_feature\")\n      }\n    });\n    this._relationTools.push({\n      state: {\n        icon: 'editAttributes.png',\n        id: 'editattributes',\n        name: t(\"editing.tools.update_feature\")\n\n      }\n    })\n  } else {\n    allrelationtools = this.getEditingService().getToolBoxById(this.relation.child).getTools();\n    allrelationtools.forEach((tool) => {\n      if(_.concat(RELATIONTOOLS[relationLayerType], RELATIONTOOLS.default).indexOf(tool.getId()) != -1) {\n        this._relationTools.push(_.cloneDeep(tool));\n      }\n    });\n  }\n\n  this._originalLayerStyle = this.getLayer().getType() == 'vector' ? this.getEditingLayer().getStyle() : null;\n  // vado ad aggiungere i workflow per link relation che add new relation\n  this._setAddLinkWorkflow();\n};\n\nconst proto = RelationService.prototype;\n\nproto._setAddLinkWorkflow = function() {\n  const add_link_workflow = {\n    vector: {\n      link: require('../workflows/linkrelationworkflow'),\n      add: require('../workflows/addfeatureworkflow')\n    },\n    table: {\n      link: require('../workflows/edittableworkflow'),\n      add: require('../workflows/addtablefeatureworkflow')\n    }\n  };\n  this._add_link_workflow = add_link_workflow[this._layerType];\n};\n\nproto._getLinkFeatureWorkflow = function() {\n  return new this._add_link_workflow.link();\n};\n\nproto._getAddFeatureWorkflow = function() {\n  return new this._add_link_workflow.add();\n};\n\nproto.getRelationTools = function() {\n  return this._relationTools\n};\n\nproto._highlightRelationSelect = function(relation) {\n  const geometryType = this.getLayer().getGeometryType();\n  let style;\n  if (geometryType == 'LineString' || geometryType == 'MultiLineString') {\n    style = new ol.style.Style({\n      stroke: new ol.style.Stroke({\n        color: 'rgb(255,255,0)',\n        width: 4\n      })\n    });\n  }\n  else if (geometryType == 'Point' || geometryType == 'MultiPoint') {\n    style = new ol.style.Style({\n      image: new ol.style.Circle({\n        radius: 8,\n        fill: new ol.style.Fill({\n          color: 'rgb(255,255,0)'\n        })\n      })\n    });\n  } else if (geometryType == 'MultiPolygon' || geometryType == 'Polygon') {\n    style = new ol.style.Style({\n      stroke: new ol.style.Stroke({\n        color: 'rgb(255,255,0)',\n        width: 4\n      }),\n      fill: new ol.style.Fill({\n        color: 'rgba(255, 255, 0, 0.5)'\n      })\n    });\n  }\n  relation.setStyle(style);\n};\n\n// funzione che lachia la funzione in base al tipo di layer\nproto.startTool = function(relationtool, index) {\n  if (this._layerType == 'vector') {\n    return this.startVectorTool(relationtool, index);\n  }\n  if (this._layerType == 'table') {\n    return this.startTableTool(relationtool, index);\n  }\n};\n\nproto.startTableTool = function(relationtool, index) {\n  const d = $.Deferred();\n  const relation = this.relations[index]; // oggetto relazione\n  const featurestore = this.getEditingService().getToolBoxById(this._layerId).getSession().getFeaturesStore();\n  const relationfeature = featurestore.getFeatureById(relation.id); // relation feature\n  GUI.setModal(false);\n  const options = this._createWorkflowOptions({\n    features: [relationfeature]\n  });\n  let workflow;\n  if (relationtool.state.id == 'deletefeature') {\n    GUI.dialog.confirm(t(\"editing.messages.delete_feature\"), (result) => {\n      if (result) {\n        this.getCurrentWorkflow().session.pushDelete(this._layerId, relationfeature);\n        this.relations.splice(index, 1);\n        featurestore.removeFeature(relationfeature);\n      }\n      d.resolve();\n    });\n  }\n  if (relationtool.state.id == 'editattributes') {\n    const EditTableFeatureWorkflow = require('../workflows/edittablefeatureworkflow');\n    workflow = new EditTableFeatureWorkflow();\n    const percContent = this._bindEscKeyUp(workflow,  function() {});\n    workflow.start(options)\n      .then((output) => {\n        const fields = this._getRelationFieldsValue(relationfeature);\n        fields.forEach((_field) => {\n          relation.fields.forEach((field) => {\n            if (field.name == _field.name)\n              field.value = _field.value;\n          })\n        });\n        d.resolve(output);\n      })\n      .fail((err) => {\n        d.reject(err)\n      })\n      .always(() => {\n        workflow.stop();\n        GUI.hideContent(false, percContent);\n        this._unbindEscKeyUp();\n        GUI.setModal(true);\n      })\n  }\n  return d.promise()\n};\n\nproto.startVectorTool = function(relationtool, index) {\n  const d = $.Deferred();\n  const relation = this.relations[index]; // oggetto relazione\n  const relationfeature = this._getRelationFeature(relation.id); // relation feature\n  const workflows = {\n    ModifyGeometryVertexWorkflow: require('../workflows/modifygeometryvertexworkflow'),\n    MoveFeatureWorkflow : require('../workflows/movefeatureworkflow'),\n    DeleteFeatureWorkflow : require('../workflows/deletefeatureworkflow'),\n    EditFeatureAttributesWorkflow : require('../workflows/editfeatureattributesworkflow')\n  };\n  let workflow;\n  let start;\n  GUI.setModal(false);\n\n  Object.entries(workflows).forEach(([key, classworkflow]) => {\n    if (relationtool.getOperator() instanceof classworkflow) {\n      workflow = new classworkflow();\n      return false;\n    }\n  });\n\n  const options = this._createWorkflowOptions({\n    features: [relationfeature]\n  });\n\n  this._highlightRelationSelect(relationfeature);\n\n  const percContent = this._bindEscKeyUp(workflow,  function() {\n    relation.setStyle(this._originalLayerStyle);\n  });\n\n  if (workflow instanceof workflows.DeleteFeatureWorkflow || workflow instanceof workflows.EditFeatureAttributesWorkflow )\n    start  = workflow.startFromLastStep(options);\n  else\n    start = workflow.start(options);\n  start.then((outputs) => {\n      if (relationtool.getId() == 'deletefeature') {\n        // vado a cambiarli lo style\n        relationfeature.setStyle(this._originalLayerStyle);\n        this.getEditingLayer().getSource().removeFeature(relationfeature);\n        this.getCurrentWorkflow().session.pushDelete(this._layerId, relationfeature);\n        this.relations.splice(index, 1)\n      }\n      if (relationtool.getId() == 'editattributes') {\n        const fields = this._getRelationFieldsValue(relationfeature);\n        fields.forEach((_field) => {\n          relation.fields.forEach((field) => {\n            if (field.name == _field.name)\n              field.value = _field.value;\n          })\n        });\n      }\n      d.resolve(outputs)\n    })\n    .fail((err) => {\n      d.reject(err)\n    })\n    .always(() => {\n      // vado a mettere lo style della relazione\n      this.showRelationStyle();\n      workflow.stop();\n      GUI.hideContent(false, percContent);\n      this._unbindEscKeyUp();\n      GUI.setModal(true);\n    });\n  return d.promise()\n};\n\n// ritorna il layer editable estartto dal layer del catalogo\nproto.getLayer = function() {\n  return this.getEditingService().getLayerById(this.relation.child);\n};\n\n// ritorna il layer che è effettivamente in editing utilizzato dai task\nproto.getEditingLayer = function() {\n  return this.getEditingService().getEditingLayer(this.relation.child);\n};\n\nproto.getEditingService = function() {\n  const EditingService = require('./editingservice');\n  return EditingService;\n};\n\nproto.updateExternalKeyValueRelations = function(input) {\n  const session = this.getEditingService().getToolBoxById(this.relation.father).getSession();\n  const layerId = this.relation.child;\n  if (input.name == this.relation.fatherField) {\n    this._currentFeatureFatherFieldValue = input.value;\n    this.relations.forEach((relation) => {\n      const fields = relation.fields;\n      fields.forEach((field) => {\n        if (field.name == this.relation.childField){\n          field.value = this._currentFeatureFatherFieldValue\n        }\n      });\n      relation = this._getRelationFeature(relation.id);\n      // vado a setare il valore della relazione e aggiornare la sessione\n      const originalRelation = relation.clone();\n      relation.set(this.relation.childField, input.value);\n      if (!relation.isNew()) {\n        session.pushUpdate(layerId, relation, originalRelation);\n      }\n    })\n  }\n};\n\n// funzione che gestisce l'evento keyup esc\nproto._escKeyUpHandler = function(evt) {\n  if (evt.keyCode === 27) {\n    evt.data.workflow.stop();\n    GUI.hideContent(false, evt.data.percContent);\n    evt.data.callback()\n  }\n};\n\n// funzione che fa unbind dell'evento esc key\nproto._unbindEscKeyUp = function() {\n  $(document).unbind('keyup', this._escKeyUpHandler);\n};\n\nproto._bindEscKeyUp = function(workflow, callback) {\n  const percContent = GUI.hideContent(true);\n  $(document).one('keyup', {\n    workflow: workflow,\n    percContent: percContent,\n    callback: callback || function() {}\n  }, this._escKeyUpHandler);\n  return percContent;\n};\n\nproto._getRelationFieldsValue = function(relation) {\n  const layer = this.getLayer();\n  const fields = layer.getFieldsWithValues(relation, {\n    relation: true\n  });\n  return fields;\n};\n\nproto._createRelationObj = function(relation) {\n  return {\n    fields: this._getRelationFieldsValue(relation),\n    id: relation.getId()\n  }\n};\n\nproto.addRelation = function() {\n  GUI.setModal(false);\n  const workflow = this._getAddFeatureWorkflow();\n  const percContent = this._bindEscKeyUp(workflow);\n  const options = this._createWorkflowOptions();\n  workflow.start(options)\n    .then((outputs) => {\n      const relation = outputs.features[outputs.features.length - 1]; // vado a prende l'ultima inserrita\n      // vado a settare il valore\n      relation.set(this.relation.childField, this._currentFeatureFatherFieldValue);\n      this.relations.push(this._createRelationObj(relation));\n    })\n    .fail((err) => {\n    })\n    .always(() =>{\n      GUI.hideContent(false, percContent);\n      this._unbindEscKeyUp();\n      workflow.stop();\n      GUI.setModal(true);\n    });\n};\n\n// funzione che screa lo stile delle relazioni diepndenti riconoscibili con il colore del padre\nproto._getRelationAsFatherStyleColor = function() {\n  const fatherLayerStyle = this.getEditingService().getEditingLayer(this.relation.father).getStyle();\n  const fatherLayerStyleColor = fatherLayerStyle.getFill() ? fatherLayerStyle.getFill() : fatherLayerStyle.getStroke();\n  return fatherLayerStyleColor.getColor();\n};\n\nproto.linkRelation = function() {\n  const workflow = this._getLinkFeatureWorkflow();\n  const percContent = this._bindEscKeyUp(workflow);\n  const options = this._createWorkflowOptions();\n  workflow.start(options)\n    .then((outputs) => {\n      const relation = outputs.features[0];\n      let relationAlreadyLinked = false;\n      this.relations.forEach((rel) => {\n        if (rel.id == relation.getId()) {\n          relationAlreadyLinked = true;\n          return false;\n        }\n      });\n      if (!relationAlreadyLinked) {\n        const originalRelation = relation.clone();\n        relation.set(this.relation.childField, this._currentFeatureFatherFieldValue);\n        this.getCurrentWorkflow().session.pushUpdate(this._layerId , relation, originalRelation);\n        this.relations.push(this._createRelationObj(relation));\n      } else {\n        GUI.notify.warning(t('relation_already_added'));\n      }\n    })\n    .fail((err) => {\n    })\n    .always(() =>{\n      workflow.stop();\n      GUI.hideContent(false, percContent);\n      this._unbindEscKeyUp()\n    });\n};\n\nproto._checkIfExternalFieldRequired = function() {\n  const layerId = this.relation.child;\n  const fieldName = this.relation.childField;\n  return this.getEditingService().isFieldRequired(layerId, fieldName);\n};\n\nproto.isRequired = function() {\n  return this._isExternalFieldRequired;\n};\n\nproto._getRelationFeature = function(featureId) {\n  const editingLayer = this.getEditingLayer();\n  const feature = editingLayer.getSource().getFeatureById(featureId);\n  return feature;\n};\n\nproto.unlinkRelation = function(index) {\n  let relation = this.relations[index];\n  relation = this.getEditingLayer().getSource().getFeatureById(relation.id);\n  const originalRelation = relation.clone();\n  relation.set(this.relation.childField, null);\n  this.getCurrentWorkflow().session.pushUpdate(this._layerId, relation, originalRelation);\n  this.relations.splice(index, 1);\n};\n\n\nproto.getCurrentWorkflow = function() {\n  return this.getEditingService().getCurrentWorflow();\n};\n\nproto._createWorkflowOptions = function(options) {\n  options = options || {};\n  const workflow_options = {\n    context: {\n      session: this.getCurrentWorkflow().session,\n      layer: this.getLayer(),\n      excludeFields: [this.relation.childField],\n      fatherValue: this._currentFeatureFatherFieldValue\n    },\n    inputs: {\n      features: options.features || [],\n      layer: this.getEditingLayer()\n    }\n  };\n  return workflow_options;\n};\n\nproto.showRelationStyle = function() {\n  let style;\n  const layerType = this.getLayer().getType();\n  if (layerType == 'table')\n    return;\n  const geometryType = this.getLayer().getGeometryType();\n  switch (geometryType) {\n    case 'Point' || 'MultiPoint':\n      const color = this._originalLayerStyle.getImage().getFill().getColor();\n      style = new ol.style.Style({\n        image: new ol.style.Circle({\n          radius: 8,\n          fill: new ol.style.Fill({\n            color: color\n          }),\n          stroke: new ol.style.Stroke({\n            width: 5,\n            color:  this._getRelationAsFatherStyleColor()\n          })\n        })\n      });\n      break;\n    case 'Line' || 'MultiLine':\n      style = new ol.style.Style({\n        fill: new ol.style.Fill({\n          color: color\n        }),\n        stroke: new ol.style.Stroke({\n          width: 5,\n          color: this._getRelationAsFatherStyleColor()\n        })\n      });\n      break;\n    case 'Polygon' || 'MultiPolygon':\n      style =  new ol.style.Style({\n        stroke: new ol.style.Stroke({\n          color:  this._getRelationAsFatherStyleColor(),\n          width: 5\n        }),\n        fill: new ol.style.Fill({\n          color: color,\n          opacity: 0.5\n        })\n      })\n  }\n\n  this.relations.forEach((relation) => {\n    let relationfeature = this._getRelationFeature(relation.id);\n    relationfeature.setStyle(style);\n  })\n};\n\n\nproto.hideRelationStyle = function() {\n  if (this._layerType == 'vector') {\n    this.relations.forEach((relation) => {\n      relationfeature = this._getRelationFeature(relation.id);\n      relationfeature.setStyle(this._originalLayerStyle);\n    })\n  }\n};\n\nproto.relationFields = function(relation) {\n  const attributes = [];\n  const originaRelation = this._getRelationFeature(relation.id);\n  _.forEach(relation.fields, function (field) {\n    let value = field.value;\n    if (field.name == originaRelation.getPk() && originaRelation.isNew() && !field.editable)\n      value = null;\n    attributes.push({label: field.label, value: value})\n  });\n  return attributes\n};\n\n\n\nmodule.exports = RelationService;\n","const GUI = g3wsdk.gui.GUI;\nconst t = g3wsdk.core.i18n.t;\n\nconst TableService = function(options = {}) {\n  this._features = options.features || []; // original features\n  this._promise = options.promise;\n  this._context = options.context;\n  this._inputs = options.inputs;\n  this._headers = options.headers;\n  this._fatherValue = options.fatherValue;\n  this._foreignKey = options.foreignKey;\n  this._workflow = null;\n  this.state = {\n    features: [],\n    isrelation: options.isrelation || false, //\n    title: options.title || 'Link relation'\n  };\n  this.init = function() {\n    //filter the original feature based on if is a relation\n    this._features = !this.state.isrelation ? this._features : this._features.filter((feature) => {\n      return feature.get(this._foreignKey) != this._fatherValue\n    });\n    // set values\n    this._features.forEach((feature) => {\n      const properties = feature.getProperties();\n      this.state.features.push(properties);\n    });\n  };\n\n  this.init();\n};\n\nconst proto = TableService.prototype;\n\n\nproto.save = function() {\n  this._promise.resolve();\n};\n\nproto.cancel = function() {\n  this._promise.reject();\n};\n\nproto.deleteFeature = function(index) {\n  GUI.dialog.confirm(t('editing.messages.delete_feature'), (result) => {\n    if (result) {\n      const feature = this._features[index];\n      const session = this._context.session;\n      const layerId = this._inputs.layer.getId();\n      session.pushDelete(layerId, feature);\n      this.state.features.splice(index, 1);\n      this._features.splice(index, 1);\n    }\n  });\n};\n\nproto.editFeature = function(index) {\n  const feature = this._features[index];\n  const EditTableFeatureWorkflow = require('../workflows/edittablefeatureworkflow');\n  this._workflow = new EditTableFeatureWorkflow();\n  const inputs = this._inputs;\n  inputs.features.push(feature);\n  const options = {\n    context: this._context,\n    inputs: inputs\n  };\n  this._workflow.start(options)\n    .then((outputs) => {\n      const feature = outputs.features[0];\n      Object.entries(this.state.features[index]).forEach(([key, value]) => {\n        this.state.features[index][key] = feature.get(key);\n      });\n      const pk = feature.getPk();\n      this.state.features[index][pk] = feature.getId();\n    })\n    .fail((err) => {})\n};\n\nproto.linkFeature = function(index) {\n  const feature = this._features[index];\n  this._promise.resolve({\n      features: [feature]\n    });\n};\n\nproto._setLayout = function() {\n  const editing_table_content_height = $('#editing_table').height();\n  let height_70 = (editing_table_content_height * 70) / 100;\n  return height_70\n};\n\n\n\nmodule.exports = TableService;\n","module.exports = \"<div id=editing_table class=g3w-editing-table> <div class=editing_table_header> <div @click=stop v-if=state.isrelation style=margin-left:auto> <button :class=\\\"g3wtemplate.font['close']\\\" class=\\\"pull-right close-panel-button\\\"></button> </div> <h3 class=editing_table_title>{{ state.title }}</h3> <div class=editing_table_relation_messagge v-if=state.isrelation v-t=\\\"'editing.relation.table.info'\\\"> </div> </div> <table class=display style=width:100%> <thead> <tr> <th v-for=\\\"header in headers\\\">{{ header.label }}</th> <th v-show=!state.isrelation></th> <th v-show=!state.isrelation></th> </tr> </thead> <tbody> <tr @click=\\\"state.isrelation ? linkFeature(index) : null\\\" v-for=\\\"(feature, index) in state.features\\\" :key=index> <td v-if=showValue(key) v-for=\\\"(value, key) in feature\\\"> {{ getValue(value) }}</td> <td v-show=!state.isrelation> <i :class=\\\"g3wtemplate.font['trash-o']\\\" class=g3w-icon style=color:red aria-hidden=true @click=deleteFeature(index)></i> </td> <td v-show=!state.isrelation> <i :class=\\\"g3wtemplate.font['pencil']\\\" class=g3w-icon style=color:#008d4c aria-hidden=true @click=editFeature(index)></i> </td> </tr> </tbody> </table> <div id=buttons v-show=!state.isrelation style=display:flex;justify-content:center> <div> <button v-t=\\\"'save'\\\" class=\\\"btn btn-success\\\" style=margin-right:10px @click=save></button> <button v-t=\\\"'cancel'\\\" class=\\\"btn btn-primary\\\" @click=cancel></button> </div> </div> </div> \";","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst Component = g3wsdk.gui.vue.Component;\nconst TableService = require('../tableservice');\n\nconst InternalComponent = Vue.extend({\n  template: require('./table.html'),\n  data: function() {\n    return {\n      headers: this.$options.headers,\n      state: null\n    }\n  },\n  methods: {\n    showValue(key) {\n      return !!this.headers.find((header) => {\n        return header.name == key\n      })\n    },\n    stop: function() {\n      this.$options.service.cancel();\n    },\n    save: function() {\n      this.$options.service.save();\n    },\n    cancel: function() {\n      this.$options.service.cancel();\n    },\n    deleteFeature: function(index) {\n      this.$options.service.deleteFeature(index);\n    },\n    editFeature: function(index) {\n      this.$options.service.editFeature(index);\n    },\n    linkFeature: function(index) {\n     this.$options.service.linkFeature(index);\n    },\n    _setLayout: function() {\n      return this.$options.service._setLayout();\n    },\n    getValue(value) {\n       if (value && typeof  value === 'object' && value.constructor === Object) {\n         value = value.value;\n       }\n       return value;\n    }\n  },\n  watch: {\n    'state.relations' : function() {\n      this.$nextTick(function() {\n      });\n    }\n  },\n  mounted: function() {\n    this.$nextTick(() => {\n      const maxHeightTable = this._setLayout();\n      $('#editing_table table').DataTable({\n        \"pageLength\": 10,\n        \"scrollX\": true,\n        \"scrollY\": maxHeightTable + 'px',\n        \"scrollCollapse\": true,\n        \"order\": [ 0, 'asc' ],\n        columnDefs: [\n          { orderable: false, targets: [-1, -2] }\n        ]\n      });\n    });\n  }\n});\n\nconst TableComponent = function(options) {\n  base(this);\n  options = options || {};\n  const service = options.service || new TableService({\n    headers: options.headers,\n    features: options.features,\n    promise: options.promise,\n    context: options.context,\n    inputs: options.inputs,\n    isrelation: options.isrelation,\n    fatherValue: options.fatherValue,\n    foreignKey: options.foreignKey,\n    title: options.title\n  });\n  const headers = options.headers || [];\n  // istanzio il componente interno\n  this.setService(service);\n  const internalComponent = new InternalComponent({\n    service: service,\n    headers: headers\n  });\n  this.setInternalComponent(internalComponent);\n  internalComponent.state = service.state;\n\n  this.unmount = function() {\n    return base(this, 'unmount');\n  };\n\n  this.layout = function() {\n    const maxHeightTable = this.getService()._setLayout();\n    $('#editing_table div.dataTables_scrollBody').height( maxHeightTable );\n  }\n};\n\ninherit(TableComponent, Component);\n\n\nmodule.exports = TableComponent;\n\n\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst G3WObject = g3wsdk.core.G3WObject;\n\n// Calsse che rappresenta di fatto\n// il bottone all'interno dell'editor control per l'editing\nfunction Tool(options) {\n  base(this);\n  options = options || {};\n  this._session = options.session;\n  // prendo il layer\n  this._layer = options.layer;\n  // gli viene passato l'operatore\n  // l'oggeto che si occuperà materialmente di gestire l'editazione del layer\n  // verosimilmente sarà un oggetto workflow\n  this._op = new options.op();\n  //stato dell'oggetto tool\n  // reattivo\n  this.state = {\n    id: options.id,\n    name: options.name,\n    enabled: false,\n    active: false,\n    icon: options.icon,\n    message: null,\n    messages: this._op.getMessages()\n  };\n}\n\ninherit(Tool, G3WObject);\n\nconst proto = Tool.prototype;\n\n// funzione che al click del bottone lancio\nproto.start = function() {\n  const options = {};\n  // come inpust al tool e di conseguenza al worflow\n  // passo il layer e features\n  options.inputs = {\n    layer: this._layer,\n    features: []\n  };\n  //passo al context la sessione\n  options.context = {\n    session: this._session,\n    layer: this._session.getEditor().getLayer()\n  };\n  // funzione che mi permette di far ripartire\n  // l'operatore/workflow quando è arrivato alla fine\n  const startOp = (options) => {\n    this._op.once('settoolsoftool', (tools) => {\n      this.emit('settoolsoftool', tools);\n    });\n    this._op.once('active', (index) => {\n      this.emit('active', index)\n    });\n    this._op.once('deactive', (index) => {\n      this.emit('deactive', index)\n    });\n    this._op.start(options)\n      .then((outputs) => {\n        // vado a salvare la sessione\n        this._session.save()\n          .then(() => {});\n      })\n      .fail(() =>  {\n        // in caso di mancato successo faccio il rollback\n        // della sessione da vedere se li\n        const EditingService = require('../services/editingservice');\n        this._session.rollback()\n          .then((relationsChanges) => {\n            EditingService.rollbackRelations(relationsChanges);\n          })\n      })\n      .always(() => {\n        options.inputs.features = [];\n        if (this._session.getEditor().getLayer().getType() != 'table')\n          startOp(options);\n        else\n          this.stop();\n      })\n  };\n  // verifico che sia definito l'operatore\n  if (this._op) {\n    this.state.active = true;\n    // lancio la funzione che mi permette di riavviarea\n    // l'operatore (workflow)  ogni volt è andato a buon fine\n    startOp(options);\n  }\n};\n\n//fa lo stop del tool\nproto.stop = function() {\n  const d = $.Deferred();\n  //console.log('Stopping Tool ... ');\n  if (this._op) {\n    this._op.stop()\n      .then(() => {\n      })\n      .fail((err) => {\n        //in caso di errore faccio un rollback della sessione\n        this._session.rollback();\n      })\n      .always(() => {\n        this.state.active = false;\n        this.emit('stop');\n        d.resolve();\n      })\n  }\n  return d.promise();\n};\n\nproto.getState = function() {\n  return this.state;\n};\n\nproto.setState = function(state) {\n  this.state = state;\n};\n\nproto.getId = function() {\n  return this.state.id;\n};\n\nproto.setId = function(id) {\n  this.state.id = id;\n};\n\nproto.getName = function() {\n  return this.state.name;\n};\n\nproto.setActive = function(bool) {\n  this.state.active = _.isBoolean(bool) ? bool : false;\n};\n\nproto.isActive = function() {\n  return this.state.active;\n};\n\nproto.getIcon = function() {\n  return this.state.icon;\n};\n\nproto.setIcon = function(icon) {\n  this.state.icon = icon;\n};\n\nproto.setEnabled = function(bool) {\n  this.state.enabled = _.isBoolean(bool) ? bool : false;\n};\n\nproto.isEnabled = function() {\n  return this.state.enabled;\n};\n\nproto.getOperator = function() {\n  return this._op;\n};\n\n//restituisce la sessione\nproto.getSession = function() {\n  return this._session;\n};\n\n//setta la sessione\nproto.setSession = function(session) {\n  this._session = session;\n};\n\nproto.clear = function() {\n  this.state.enabled = false;\n  this.state.active = false;\n};\n\nproto.getMessage = function() {\n  const operator = this.getOperator();\n  return operator.getRunningStep() ? this.state.messages : null;\n};\n\nproto.setMessage = function(message) {\n  this.state.message = message;\n};\n\nproto.clearMessage = function() {\n  this.state.message = null;\n};\n\nmodule.exports = Tool;\n","const Layer = g3wsdk.core.layer.Layer;\nconst GUI = g3wsdk.gui.GUI;\nconst EditToolsFactory = require('./toolsfactory');\nconst ToolBox = require('./toolbox');\n\n// classe costruttrice di ToolBoxes\nfunction EditorToolBoxesFactory() {\n  this._mapService = GUI.getComponent('map').getService();\n  // metodo adibito alla costruzione dell'Editor Control\n  // e dei tasks associati\n  // il layer è il layer di editing originale da cui tutte le feature\n  // verranno chiamate tramite il featuresstore provider\n  this.build = function(layer) {\n    // estraggo il layer dell'editor\n    const editor = layer.getEditor();\n    // estraggo il tipo di layer\n    const layerType = layer.getType();\n    const layerId = layer.getId();\n    // definisce il layer che sarà assegnato al toolbox e ai tools\n    let editingLayer;\n    let tools;\n    switch (layerType) {\n      // caso layer editabile vettoriale\n      case Layer.LayerTypes.VECTOR:\n        const geometryType = layer.getGeometryType();\n        // vado a recuperare il layer (ol.Layer) della mappa\n        // su cui tutti i tool agiranno\n        editingLayer = this._mapService.getLayerById(layerId);\n        tools = EditToolsFactory.build({\n          layer: editingLayer,\n          geometryType: geometryType,\n          type: layerType\n        });\n        break;\n      // caso layer tabellare da mettere in piedi\n      case Layer.LayerTypes.TABLE:\n        // vado a clonar il layer per utilizzarlo nei vari task\n        editingLayer = _.cloneDeep(layer);\n        tools = EditToolsFactory.build({\n          layer: editingLayer,\n          type: layerType\n        });\n        break;\n      default:\n        tools = [];\n        break;\n    }\n    return new ToolBox({\n      id: layer.getId(),\n      color: layer.getColor(),\n      type: layerType,\n      editor: editor,\n      layer: editingLayer,\n      tools: tools,\n      title: \"Edit \" + layer.getName()\n    })\n  };\n}\n\nmodule.exports = new EditorToolBoxesFactory;\n","const Layer = g3wsdk.core.layer.Layer;\nconst Geometry = g3wsdk.core.geometry.Geometry;\nconst t = g3wsdk.core.i18n.t;\nconst Tool = require('./tool');\nconst AddFeatureWorkflow = require('../workflows/addfeatureworkflow');\nconst ModifyGeometryVertexWorkflow = require('../workflows/modifygeometryvertexworkflow');\nconst MoveFeatureWorkflow = require('../workflows/movefeatureworkflow');\nconst DeleteFeatureWorkflow = require('../workflows/deletefeatureworkflow');\nconst EditFeatureAttributesWorkflow = require('../workflows/editfeatureattributesworkflow');\nconst EditTableFeaturesWorkflow = require('../workflows/edittableworkflow');\nconst AddTableFeatureWorflow = require('../workflows/addtablefeatureworkflow');\n\n// classe costruttrice di Tools\nfunction EditorToolsFactory() {\n  // create a single tool\n  this.buildTool = function(options) {\n    //TODO\n  };\n  // e dei tasks associati\n  this.build = function(options) {\n    options = options || {};\n    const type = options.type || Layer.LayerTypes.VECTOR;\n    const layer = options.layer;\n    let tools;\n    switch (type) {\n      case Layer.LayerTypes.VECTOR:\n        const geometryType = options.geometryType;\n        switch (geometryType) {\n          case Geometry.GeometryTypes.POINT:\n          case Geometry.GeometryTypes.MULTIPOINT:\n            tools = [\n              new Tool({\n                id: 'addfeature',\n                name: t(\"editing.tools.add_feature\"),\n                icon: \"addPoint.png\",\n                layer: layer,\n                op: AddFeatureWorkflow\n              }),\n              new Tool({\n                id: 'movefeature',\n                name: t(\"editing.tools.move_feature\"),\n                icon: \"movePoint.png\",\n                layer: layer,\n                type: type,\n                op: MoveFeatureWorkflow\n              }),\n              new Tool({\n                id: 'deletefeature',\n                name: t(\"editing.tools.delete_feature\"),\n                icon: \"deletePoint.png\",\n                layer: layer,\n                op: DeleteFeatureWorkflow\n              }),\n              new Tool({\n                id: 'editattributes',\n                name: t(\"editing.tools.update_feature\"),\n                icon: \"editAttributes.png\",\n                layer: layer,\n                op: EditFeatureAttributesWorkflow\n              })\n            ];\n            break;\n          case Geometry.GeometryTypes.LINESTRING:\n          case Geometry.GeometryTypes.MULTILINESTRING:\n          case Geometry.GeometryTypes.LINE:\n          case Geometry.GeometryTypes.MULTILINE:\n            tools = [\n              new Tool({\n                id: 'addfeature',\n                name: t(\"editing.tools.add_feature\"),\n                icon: \"addLine.png\",\n                layer: layer,\n                type: type,\n                op: AddFeatureWorkflow\n              }),\n              new Tool({\n                id: 'movevertex',\n                name: t(\"editing.tools.update_vertex\"),\n                icon: \"moveVertex.png\",\n                layer: layer,\n                op: ModifyGeometryVertexWorkflow\n              }),\n              new Tool({\n                id: 'deletefeature',\n                name: t(\"editing.tools.delete_feature\"),\n                icon: \"deleteLine.png\",\n                layer: layer,\n                op: DeleteFeatureWorkflow\n              }),\n              new Tool({\n                id: 'editattributes',\n                name: t(\"editing.tools.update_feature\"),\n                icon: \"editAttributes.png\",\n                layer: layer,\n                op: EditFeatureAttributesWorkflow\n              })\n            ];\n            break;\n          case Geometry.GeometryTypes.POLYGON:\n          case Geometry.GeometryTypes.MULTIPOLYGON:\n            tools = [\n              new Tool({\n                id: 'addfeature',\n                name: t(\"editing.tools.add_feature\"),\n                icon: \"AddPolygon.png\",\n                layer: layer,\n                op: AddFeatureWorkflow\n              }),\n              new Tool({\n                id: 'movefeature',\n                name: t(\"editing.tools.move_feature\"),\n                icon: \"MovePolygon.png\",\n                layer: layer,\n                op: MoveFeatureWorkflow\n              }),\n              new Tool({\n                id: 'movevertex',\n                name: t(\"editing.tools.update_vertex\"),\n                icon: \"MovePolygonVertex.png\",\n                layer: layer,\n                op: ModifyGeometryVertexWorkflow\n              }),\n              new Tool({\n                id: 'deletefeature',\n                name: t(\"editing.tools.delete_feature\"),\n                icon: \"deletePolygon.png\",\n                layer: layer,\n                op: DeleteFeatureWorkflow\n              }),\n              new Tool({\n                id: 'editattributes',\n                name: t(\"editing.tools.update_feature\"),\n                icon: \"editAttributes.png\",\n                layer: layer,\n                op: EditFeatureAttributesWorkflow\n              })\n            ];\n            break;\n        }\n        break;\n      // caso layer tabellare da mettere in piedi\n      case Layer.LayerTypes.TABLE:\n        tools = [\n          new Tool({\n            id: 'addfeature',\n            name: t(\"editing.tools.add_feature\"),\n            icon: \"addTableRow.png\",\n            layer: layer,\n            op: AddTableFeatureWorflow\n          }),\n          new Tool({\n            id: 'edittable',\n            name: t(\"editing.tools.update_feature\"),\n            icon: \"editAttributes.png\",\n            layer: layer,\n            op: EditTableFeaturesWorkflow\n          })\n        ];\n        break;\n      default:\n        tools = [];\n        break;\n    }\n    return tools\n  };\n}\n\nmodule.exports = new EditorToolsFactory;\n","module.exports = \"<div @click=\\\"state.enabled ? toggletool(): null\\\" class=editbtn :class=\\\"{'enabled' : state.enabled, 'toggled' : state.active}\\\"> <img height=25px width=25px :alt=state.name :title=state.name :src=\\\"resourcesurl + 'images/'+ state.icon\\\"/> </div> \";","var ToolComponent = Vue.extend({\n  template: require('./tool.html'),\n  props: ['state' ,'resourcesurl'],\n  data: function() {\n    return {}\n  },\n  methods: {\n    toggletool: function() {\n      // se non è attivo lo attivo emettendo il segnale\n      if (!this.state.active) {\n        this.$emit('setactivetool', this.state.id);\n      } else {\n        this.$emit('stopactivetool');\n      }\n    }\n  }\n});\n\n// dichairo il componente tool in generale da poter esserre riutilizzato\nVue.component('tool', ToolComponent);\n\nmodule.exports = ToolComponent;\n\n\n","module.exports = \"<div class=toolbox> <div :class=\\\"{'disableddiv' : !isLayerReady }\\\" :id=\\\"'id_toolbox_'+ state.id\\\"> <div @click=select class=\\\"panel panel-primary\\\" :class=\\\"{ 'toolboxselected': state.selected }\\\"> <div v-show=!isLayerReady class=bar-loader></div> <div class=\\\"panel-heading container\\\" style=width:100% :style=\\\"{ background: state.color}\\\"> <div v-if=father style=margin-right:5px class=\\\"pull-left enabled dropdown\\\"> <span class=g3w-icon :class=\\\"g3wtemplate.font['relation']\\\"></span> <div class=dropdown-content style=padding:5px> <div v-for=\\\"dependency in state.editing.dependencies\\\" style=color:#000>{{ dependency }}</div> </div> </div> <div class=panel-title :class=\\\"[father ? 'col-md-6' : 'col-md-8']\\\"> {{ state.title }} </div> <div @click=toggleEditing class=\\\"editbtn pull-right\\\" :class=\\\"{'enabled' : isLayerReady,  'g3w-icon-toggled' : state.editing.on}\\\"> <span style=font-size:1.1em;padding:5px :class=\\\"g3wtemplate.font['pencil']\\\"></span> </div> </div> <div class=panel-body> <div style=display:flex;justify-content:flex-start> <tool :state=toolstate :resourcesurl=resourcesurl @stopactivetool=stopActiveTool @setactivetool=setActiveTool v-for=\\\"toolstate in state.tools\\\"> </tool> </div> <div class=message style=margin-top:5px :id=\\\"'id_toolbox_messages_'+ state.id\\\"> <div v-html=state.message></div> <transition name=fade> <toolsoftool v-if=showtoolsoftool :tools=state.toolsoftool></toolsoftool> </transition> <div class=toolbox_help_message v-html=toolhelpmessage></div> <div v-t=\\\"'editing.messages.loading_data'\\\" v-show=state.loading> <img style=padding-left:3px :src=\\\"resourcesurl + '/images/loader.svg'\\\"> </div> </div> </div> </div> </div> </div> \";","const ToolComponent = require('./tool');\nconst ToolsOfToolComponent = require('./toolsoftool');\n\nconst ToolboxComponent = Vue.extend({\n  template: require('./toolbox.html'),\n  props: ['state', 'resourcesurl'],\n  data: function() {\n    return {\n      active: false,\n      showtoolsoftool: true\n    }\n  },\n  components: {\n    'tool': ToolComponent,\n    'toolsoftool': ToolsOfToolComponent\n  },\n  methods: {\n    select: function() {\n      if (!this.isLayerReady)\n        return;\n      if (!this.state.selected) {\n        this.$emit('setselectedtoolbox', this.state.id);\n      }\n    },\n    toggleEditing() {\n      //se il toolbox non è ancora abilitato non faccio niente\n      if (!this.state.layerstate.editing.ready)\n        return;\n      this.state.editing.on ? this.$emit('stoptoolbox', this.state.id): this.$emit('starttoolbox', this.state.id);\n    },\n    saveEdits() {\n      this.$emit('savetoolbox', this.state.id);\n    },\n    stopActiveTool() {\n      this.$emit('stopactivetool', this.state.id);\n    },\n    setActiveTool(toolId) {\n      this.$emit('setactivetool', toolId, this.state.id);\n    }\n  },\n  computed: {\n    father: function() {\n      return this.state.editing.father && !!this.state.editing.dependencies.length;\n    },\n    toolhelpmessage() {\n      return this.state.toolmessages.help;\n    },\n    showtoolsoftool() {\n      return !!this.state.toolsoftool.length;\n    },\n    isLayerReady() {\n      return this.state.layerstate.editing.ready;\n    }\n  }\n});\n\nmodule.exports = ToolboxComponent;\n\n\n","module.exports = \"<div id=toolsoftoolcontainer style=display:flex;margin:5px;padding:5px;border-radius:5px> <component v-for=\\\"tool in tools\\\" :key=tool.type :is=tool.type :options=tool.options> </component> </div> \";","const Tools = require('./toolsoftool/tools');\n\nvar ToolsOfToolComponent = Vue.extend({\n  template: require('./toolsoftool.html'),\n  props: ['tools'],\n  components: {\n    snap: Tools.snap\n  },\n  data: function() {\n    return {}\n  }\n});\n\nmodule.exports = ToolsOfToolComponent;\n","import snap  from  './snap.vue';\nconst Tools = {\n  snap\n};\n\nmodule.exports = Tools;\n","module.exports = \"<div class=g3w-editing-panel> <div style=display:flex;margin-bottom:5px> <div style=margin-right:auto class=editing-button @click=\\\"canCommit ? commit(): null\\\" :class=\\\"{'enabled' : canCommit }\\\"> <span class=editing-icon :class=\\\"g3wtemplate.font['save']\\\"></span> </div> <div class=editing-button @click=\\\"canUndo ? undo(): null\\\" :class=\\\"{'enabled' : canUndo }\\\"> <span class=editing-icon :class=\\\"g3wtemplate.font['arrow-left']\\\"></span> </div> <div class=editing-button @click=\\\"canRedo ? redo(): null\\\" :class=\\\"{'enabled' : canRedo }\\\"> <span class=editing-icon :class=\\\"g3wtemplate.font['arrow-right']\\\"></span> </div> </div> <div id=toolboxes> <toolbox :state=toolboxstate :resourcesurl=resourcesurl @setselectedtoolbox=setSelectedToolbox @starttoolbox=startToolBox @stoptoolbox=stopToolBox @savetoolbox=saveToolBox @setactivetool=startActiveTool @stopactivetool=stopActiveTool v-for=\\\"toolboxstate in state.toolboxes\\\"> </toolbox> </div> </div> \";","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst merge =  g3wsdk.core.utils.merge;\nconst t = g3wsdk.core.i18n.t;\nconst GUI = g3wsdk.gui.GUI;\nconst Component = g3wsdk.gui.vue.Component;\nconst EditingService = require('../services/editingservice');\nconst EditingTemplate = require('./editing.html');\nconst ToolboxComponent = require('./components/toolbox');\n\nconst vueComponentOptions = {\n  template: EditingTemplate,\n  data: null,\n  components: {\n    'toolbox': ToolboxComponent //componente toolbox\n\n  },\n  transitions: {'addremovetransition': 'showhide'},\n  methods: {\n    undo: function() {\n      const session = this.state.toolboxselected.getSession();\n      const undoItems = session.undo(); // questi solo le feature (cambiamenti) che devo applicare al features stores dei singoli layers coinvolti\n      this.$options.service.undoRelations(undoItems)\n    },\n    redo: function() {\n      const session = this.state.toolboxselected.getSession();\n      const redoItems = session.redo();\n      this.$options.service.redoRelations(redoItems)\n    },\n    commit: function(toolboxId) {\n      const toolbox = this.$options.service.getToolBoxById(toolboxId);\n      this.$options.service.commit(toolbox)\n        .always((toolbox) => {\n          toolbox.restartActiveTool()\n        })\n    },\n    saveAll: function() {},\n    startToolBox: function(toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      toolbox.start();\n    },\n    stopToolBox: function(toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      if (toolbox.state.editing.history.commit)\n        this.$options.service.commit()\n          .always(function() {\n            toolbox.stop()\n          });\n      else\n        toolbox.stop();\n    },\n    saveToolBox: function(toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      toolbox.save();\n    },\n    _setActiveToolOfToolbooxSelected: function(toolId, toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      this.state.toolboxidactivetool = toolboxId;\n      const tool = toolbox.getToolById(toolId);\n      toolbox.setActiveTool(tool);\n    },\n    startActiveTool: function(toolId, toolboxId) {\n      // vado a verificare se l'id dell toolbox attivo è diverso o meno da quello premuto\n      if (this.state.toolboxidactivetool && toolboxId != this.state.toolboxidactivetool) {\n        this._checkDirtyToolBoxes(this.state.toolboxidactivetool)\n          .then((toolbox) => {\n            // vado a stoppare l'eventuale tool attivo del precedente toolbox\n            if (toolbox)\n              toolbox.stopActiveTool();\n            this._setActiveToolOfToolbooxSelected(toolId, toolboxId);\n          })\n      } else {\n        this._setActiveToolOfToolbooxSelected(toolId, toolboxId);\n      }\n    },\n    stopActiveTool: function(toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      toolbox.stopActiveTool();\n    },\n    setSelectedToolbox: function(toolboxId) {\n      const service = this.$options.service;\n      const toolbox = this._getToolBoxById(toolboxId);\n      const toolboxes = service.getToolBoxes();\n      _.forEach(toolboxes, function(toolbox) {\n        if (toolbox.isSelected()) {\n          toolbox.setSelected(false);\n          return false;\n        }\n      });\n      toolbox.setSelected(true);\n      this.state.toolboxselected = toolbox;\n      if (toolbox.getDependencies().length) {\n        this.state.message = \"<div>\\n\" +\n          t(\"editing.messages.change_toolbox_relation\") + \"\\n\" +\n          \"</div>\"\n      } else {\n        this.state.message = null;\n      }\n    },\n    _checkDirtyToolBoxes: function(toolboxId) {\n      return this.$options.service.commitDirtyToolBoxes(toolboxId);\n    },\n    // funzione che mi va a aprendere dal service il toolbox in base al suo id\n    _getToolBoxById: function(toolboxId) {\n      const service = this.$options.service;\n      const toolbox = service.getToolBoxById(toolboxId);\n      return toolbox;\n    }\n  },\n  computed: {\n    // messaggio generale dell'editing esempio comunicando che il layer\n    // che stiamo editindo è padre e quindi i figli sono disabilitati\n    message: function() {\n      const message = \"\";\n      return message;\n    },\n    canCommit: function() {\n      return this.state.toolboxselected && this.state.toolboxselected.state.editing.history.commit;\n    },\n    canUndo: function() {\n      const toolbox = this.state.toolboxselected;\n      return !_.isNull(toolbox) &&  toolbox.state.editing.history.undo;\n    },\n    canRedo: function() {\n      const toolbox = this.state.toolboxselected;\n      return !_.isNull(toolbox) && toolbox.state.editing.history.redo;\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {})\n  }\n};\n\nfunction PanelComponent(options) {\n  // proprietà necessarie. In futuro le mettermo in una classe Panel\n  // da cui deriveranno tutti i pannelli che vogliono essere mostrati nella sidebar\n  base(this, options);\n  // qui vado a tenere traccia delle due cose che mi permettono di customizzare\n  // vue component e service\n  this.vueComponent = vueComponentOptions;\n  this.name = options.name || 'Gestione dati';\n  merge(this, options);\n  // resource urls\n  this._resourcesUrl = options.resourcesUrl || GUI.getResourcesUrl();\n  this._service = options.service || EditingService;\n  // setto il componente interno\n  const InternalComponent = Vue.extend(this.vueComponent);\n  this.internalComponent = new InternalComponent({\n    service: this._service,\n    data: () => {\n      return {\n        //lo state è quello del servizio in quanto è lui che va a modificare operare sui dati\n        state: this._service.state,\n        resourcesurl: this._resourcesUrl\n      }\n    }\n  });\n\n  // sovrascrivo richiamando il padre in append\n  this.mount = function(parent) {\n    return base(this, 'mount', parent, true)\n  };\n\n  this.unmount = function() {\n    const d = $.Deferred();\n    //vado a fare lo stop del servizio che fa un po di pulizia\n    this._service.stop()\n      .then(() => {\n        //vado a riscrivere la proprietà\n        this.unmount = function() {\n          base(this, 'unmount')\n            .then(() => {\n              this._service.activeQueryInfo();\n              d.resolve()\n            });\n        };\n        this.unmount();\n      });\n    return d.promise();\n  };\n\n}\n\ninherit(PanelComponent, Component);\n\nmodule.exports = PanelComponent;\n\n\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar AddFeatureStep = require('./steps/addfeaturestep');\nvar OpenFormStep = require('./steps/openformstep');\n\nfunction AddFeatureWorflow(options) {\n  options = options || {};\n  const addfeaturestep = new AddFeatureStep(options);\n  const openformstep = new OpenFormStep(options);\n  let snapTool;\n  addfeaturestep.on('run', ({inputs, context}) => {\n    const layer = inputs.layer;\n    snapTool = {\n      type: 'snap',\n      options: {\n        source: layer.getSource(),\n        active: true\n      }\n    };\n    this.emit('settoolsoftool', [snapTool]);\n  });\n  addfeaturestep.on('run', () => {\n    this.emit('active', ['snap']);\n  });\n  addfeaturestep.on('stop', () => {\n    this.emit('deactive', ['snap']);\n  });\n\n  options.steps = [addfeaturestep, openformstep];\n  base(this, options);\n}\n\ninherit(AddFeatureWorflow, EditingWorkflow);\n\nmodule.exports = AddFeatureWorflow;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar AddTableFeatureStep = require('./steps/addtablefeaturestep');\nvar OpenFormStep = require('./steps/openformstep');\n\nfunction AddTableFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new AddTableFeatureStep(), new OpenFormStep()];\n  base(this, options);\n}\n\ninherit(AddTableFeatureWorflow, EditingWorkflow);\n\nmodule.exports = AddTableFeatureWorflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar ConfirmStep = require('./steps/confirmstep');\n\nfunction CommitFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new ConfirmStep(options)];\n  base(this, options);\n}\n\ninherit(CommitFeatureWorflow, EditingWorkflow);\n\nvar proto = CommitFeatureWorflow.prototype;\n\nmodule.exports = CommitFeatureWorflow;","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst EditingWorkflow = require('./editingworkflow');\nconst DeleteFeatureStep = require('./steps/deletefeaturestep');\nconst ConfirmStep = require('./steps/confirmstep');\n\nfunction DeleteFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new DeleteFeatureStep(), new ConfirmStep({\n    type: 'delete'}\n    )];\n  base(this, options);\n}\n\ninherit(DeleteFeatureWorflow, EditingWorkflow);\n\nmodule.exports = DeleteFeatureWorflow;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar PickFeatureStep = require('./steps/pickfeaturestep');\nvar OpenFormStep = require('./steps/openformstep');\n\nfunction EditFeatureAttributesWorkflow(options) {\n  options = options || {};\n  // workflow composto da due steps:\n  // Il primo servre per fare selezionare la feature\n  // il secondo per aprire il form\n  options.steps = [new PickFeatureStep(), new OpenFormStep()];\n  base(this, options);\n}\n\ninherit(EditFeatureAttributesWorkflow, EditingWorkflow);\n\nvar proto = EditFeatureAttributesWorkflow.prototype;\n\nmodule.exports = EditFeatureAttributesWorkflow;","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst Workflow = g3wsdk.core.workflow.Workflow;\n\n\nfunction EditingWorkflow(options={}) {\n  base(this, options);\n  this._toolsoftool = [];\n}\n\ninherit(EditingWorkflow, Workflow);\n\nconst proto = EditingWorkflow.prototype;\n\nproto.getFeatures = function() {\n  return this.getInputs().features;\n};\n\nproto.setToolsOfTool = function(tools=[]) {\n  this._toolsoftool = [tools]\n};\n\nproto.startFromLastStep = function(options) {\n  let steps = this.getSteps();\n  this.setSteps([steps.pop()]);\n  return this.start(options);\n};\n\nproto.getCurrentFeature = function() {\n  const features = this.getFeatures();\n  const length = this.getFeatures().length;\n  return features[length -1];\n};\n\nproto.getLayer = function() {\n  return this.getSession().getEditor().getLayer()\n};\n\nproto.getSession = function() {\n  return this.getContext().session;\n};\n\nmodule.exports = EditingWorkflow;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar OpenFormStep = require('./steps/openformstep');\n\nfunction EditTableFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new OpenFormStep()];\n  base(this, options);\n}\n\ninherit(EditTableFeatureWorflow, EditingWorkflow);\n\nmodule.exports = EditTableFeatureWorflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar OpenTableStep = require('./steps/opentablestep');\n\nfunction EditTableFeaturesWorkflow(options) {\n  options = options || {};\n\n  options.steps = [new OpenTableStep()];\n  base(this, options);\n}\n\ninherit(EditTableFeaturesWorkflow, EditingWorkflow);\n\nmodule.exports = EditTableFeaturesWorkflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar LinkRelationStep = require('./steps/linkrelationstep');\n\nfunction LinkRelationWorflow(options) {\n  options = options || {};\n  options.steps = [new LinkRelationStep()];\n  base(this, options);\n}\n\ninherit(LinkRelationWorflow, EditingWorkflow);\n\nmodule.exports = LinkRelationWorflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar PickFeatureStep = require('./steps/pickfeaturestep');\nvar ModifyGeometryVertexStep = require('./steps/modifygeometryvertexstep');\n\nfunction ModifyGeometryVertexWorflow(options={}) {\n  const pickstep = new PickFeatureStep(options);\n  pickstep.on('run', ({inputs, context}) => {\n    const layer = inputs.layer;\n    const snapTool = {\n      type: 'snap',\n      options: {\n        source: layer.getSource(),\n        active: false\n      }\n    };\n    this.emit('settoolsoftool', [snapTool]);\n  });\n  const modifyvertex = new ModifyGeometryVertexStep();\n  modifyvertex.on('run', () => {\n    this.emit('active', ['snap']);\n  });\n  modifyvertex.on('stop', () => {\n    this.emit('deactive', ['snap']);\n  });\n  options.steps = [pickstep, modifyvertex];\n  base(this, options);\n}\n\ninherit(ModifyGeometryVertexWorflow, EditingWorkflow);\n\nmodule.exports = ModifyGeometryVertexWorflow;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar PickFeatureStep = require('./steps/pickfeaturestep');\nvar MoveFeatureStep = require('./steps/movefeaturestep');\n\nfunction MoveFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new PickFeatureStep(), new MoveFeatureStep()];\n  base(this, options);\n}\n\ninherit(MoveFeatureWorflow, EditingWorkflow);\n\nvar proto = MoveFeatureWorflow.prototype;\n\nmodule.exports = MoveFeatureWorflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar AddFeatureTask = require('./tasks/addfeaturetask');\n\nvar AddFeatureStep = function(options={}) {\n  options.task = new AddFeatureTask(options);\n  options.help = \"editing.steps.help.draw_new_feature\";\n  base(this, options)\n};\n\ninherit(AddFeatureStep, EditingStep);\n\nmodule.exports = AddFeatureStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar Step = g3wsdk.core.workflow.Step;\nvar AddFeatureTableTask = require('./tasks/addfeaturetabletask');\n\n//creato uno step per apriore il form\nvar AddTableFeatureStep = function(options) {\n  options = options || {};\n  options.task = new AddFeatureTableTask();\n  options.help = \"editing.steps.help.new\";\n  base(this, options)\n};\n\ninherit(AddTableFeatureStep, Step);\n\nmodule.exports = AddTableFeatureStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar ConfirmTask = require('./tasks/confirmtask');\n\nvar ConfirmStep = function(options) {\n  options = options || {};\n  options.task = new ConfirmTask(options);\n  base(this, options)\n};\n\ninherit(ConfirmStep, EditingStep);\n\nmodule.exports = ConfirmStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar DeleteFeatureTask = require('./tasks/deletefeaturetask');\n\nvar DeleteFeatureStep = function(options) {\n  options = options || {};\n  options.task = new DeleteFeatureTask();\n  options.help = \"editing.steps.help.double_click_delete\";\n  base(this, options)\n};\n\ninherit(DeleteFeatureStep, EditingStep);\n\nmodule.exports = DeleteFeatureStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar Step = g3wsdk.core.workflow.Step;\n\nvar EditingStep = function(options) {\n  base(this, options)\n};\n\ninherit(EditingStep, Step);\n\nmodule.exports = EditingStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar LinkRelationTask = require('./tasks/linkrelationtask');\n\nvar LinkRelationStep = function(options) {\n  options = options || {};\n  options.task = new LinkRelationTask();\n  options.help = \"editing.steps.help.select_feature_to_relation\";\n  base(this, options)\n};\n\ninherit(LinkRelationStep, EditingStep);\n\nmodule.exports = LinkRelationStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar ModifyGeometryVertexTask = require('./tasks/modifygeometryvertextask');\n\nvar ModifyGeometryVertexStep = function(options={snap: true}) {\n  const task = new ModifyGeometryVertexTask(options);\n  options.task = task;\n  options.help = \"editing.steps.help.edit_feature_vertex\";\n  base(this, options)\n};\n\ninherit(ModifyGeometryVertexStep, EditingStep);\n\nmodule.exports = ModifyGeometryVertexStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar MoveFeatureTask = require('./tasks/movefeaturettask');\n\nvar MoveFeatureStep = function(options) {\n  options = options || {};\n  options.task = new MoveFeatureTask();\n  options.help = \"editing.steps.help.move\";\n  base(this, options)\n};\n\ninherit(MoveFeatureStep, EditingStep);\n\nmodule.exports = MoveFeatureStep;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst Step = g3wsdk.core.workflow.Step;\nconst OpenFormTask = require('./tasks/openformtask');\n\n//creato uno step per apriore il form\nconst OpenFormStep = function(options) {\n  options = options || {};\n  options.task = new OpenFormTask();\n  options.help = \"editing.steps.help.insert_attributes_feature\";\n  base(this, options)\n};\n\ninherit(OpenFormStep, Step);\n\nmodule.exports = OpenFormStep;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst Step = g3wsdk.core.workflow.Step;\nconst OpenTableTask = require('./tasks/opentabletask');\n\n//creato uno step per apriore il form\nconst OpenTableStep = function(options) {\n  options = options || {};\n  options.task = new OpenTableTask();\n  options.help = \"editing.steps.help.edit_table\";\n  base(this, options)\n};\n\ninherit(OpenTableStep, Step);\n\nmodule.exports = OpenTableStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar Step = g3wsdk.core.workflow.Step;\nvar PickFeatureTask = require('./tasks/pickfeaturetask');\n\n//creato uno step per permettere di fare il pickfeature\nvar PickFeatureStep = function(options={}) {\n  const task = new PickFeatureTask(options);\n  options.task = task ;\n  options.help = \"editing.steps.help.pick_feature\";\n  base(this, options)\n};\n\ninherit(PickFeatureStep, Step);\n\nmodule.exports = PickFeatureStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingTask = require('./editingtask');\n\nfunction AddFeatureTableTask(options) {\n  options = options || {};\n  base(this, options);\n}\n\ninherit(AddFeatureTableTask, EditingTask);\n\nvar proto = AddFeatureTableTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  var d = $.Deferred();\n  var originalLayer = context.layer;\n  var layerId = originalLayer.getId();\n  // l'etiing layer in realtà è la session per i layer tabellari\n  var editingLayer = inputs.layer;\n  var session = context.session;\n  // nella creazione della nuova feature utilizzo l'editing layer originale (TableLayer)\n  var feature = originalLayer.createNewFeature();\n  session.pushAdd(layerId, feature);\n  editingLayer.getSource().addFeature(feature);\n  inputs.features.push(feature);\n  d.resolve(inputs);\n  return d.promise();\n};\n\n\nmodule.exports = AddFeatureTableTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst Layer = g3wsdk.core.layer.Layer;\nconst Geometry = g3wsdk.core.geometry.Geometry;\nconst base =  g3wsdk.core.utils.base;\nconst EditingTask = require('./editingtask');\nconst Feature = g3wsdk.core.layer.features.Feature;\n\n// classe  per l'aggiuntadi feature\n// eridita dalla classe padre EditingTool\nfunction AddFeatureTask(options={}) {\n  this._busy = false;\n  // source del layer di editing\n  // la drw interaction per disegnare la feature\n  this.drawInteraction = null;\n  this._snap = options.snap===false ? false : true;\n  this._snapInteraction = null;\n  this._finishCondition = options.finishCondition || _.constant(true);\n  this._condition = options.condition || _.constant(true);\n\n  base(this, options);\n}\n\ninherit(AddFeatureTask, EditingTask);\n\nconst proto = AddFeatureTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  /*\n    originalLayer : è il layer di editing originale\n    editingLayer: è il layer, in questo caso ol.layer.Vector con cui gli strumenti interagiscono\n   */\n  const d = $.Deferred();\n  const editingLayer = inputs.layer;\n  //recupero la sessione dal context\n  const session = context.session;\n  const originalLayer = context.layer;\n  const layerId = originalLayer.getId();\n  // vado a rrecuperare la primary key del layer\n  const pk = originalLayer.getPk();\n  // qui vado a valutare il tipo di layer\n  switch (originalLayer.getType()) {\n    case Layer.LayerTypes.VECTOR:\n      let geometryType;\n      if (originalLayer.getEditingGeometryType() == Geometry.GeometryTypes.LINE)\n        geometryType = 'LineString';\n      else if (originalLayer.getEditingGeometryType() == Geometry.GeometryTypes.MULTILINE)\n        geometryType = 'MultiLineString';\n      else\n        geometryType = originalLayer.getEditingGeometryType();\n      //definisce l'interazione che deve essere aggiunta\n      // specificando il layer sul quale le feature aggiunte devono essere messe\n      const source = editingLayer.getSource();\n      const attributes = _.filter(originalLayer.getFields(), function(field) {\n        return field.editable && field.name != originalLayer.getPk() ;\n      });\n      // creo una source temporanea\n      const temporarySource = new ol.source.Vector();\n      this.drawInteraction = new ol.interaction.Draw({\n        type: geometryType, // il tipo lo prende dal geometry type dell'editing vetor layer che a sua volta lo prende dal tipo si geometry del vector layer originale\n        source: temporarySource, // lo faccio scrivere su una source temporanea (non vado a modificare il source featuresstore)\n        condition: this._condition,\n        finishCondition: this._finishCondition // disponibile da https://github.com/openlayers/ol3/commit/d425f75bea05cb77559923e494f54156c6690c0b\n      });\n      //aggiunge l'interazione tramite il metodo generale di editor.js\n      // che non fa altro che chaimare il mapservice\n      this.addInteraction(this.drawInteraction);\n      //setta attiva l'interazione\n      this.drawInteraction.setActive(true);\n      // viene settato sull'inizio del draw l'evento drawstart dell'editor\n      this.drawInteraction.on('drawstart',function(e) {\n      });\n      // viene settato l'evento drawend\n      this.drawInteraction.on('drawend', function(e) {\n        console.log('Drawend .......');\n        // vado ad assegnare le proprià del layer alla nuova feature\n        _.forEach(attributes, function(attribute) {\n          e.feature.set(attribute.name, null);\n        });\n        const feature = new Feature({\n          feature: e.feature,\n          pk: pk // passo la pk della feature\n        });\n        // verifico se la pk è editabile o meno\n        originalLayer.isPkEditable() ?  feature.setNew() : feature.setTemporaryId();\n        // lo setto come add feature lo state\n        // vado a aggiungerla\n        source.addFeature(feature);\n        //source.readFeatures().push(feature);\n        // devo creare un clone per evitare che quando eventualmente sposto la feature appena aggiunta\n        // questa non sovrascriva le feature nuova originale del primo update\n        session.pushAdd(layerId, feature);\n        inputs.features.push(feature);\n        d.resolve(inputs);\n      });\n      //snapping\n      /*if (this._snap) {\n        this._snapInteraction = new ol.interaction.Snap({\n          source: editingLayer.getSource()\n        });\n        this.addInteraction(this._snapInteraction);\n      }*/\n      break;\n  }\n  return d.promise();\n};\n\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  console.log('stop add task ...');\n  //rimuove e setta a null la _snapInteraction\n  if (this._snapInteraction) {\n     this.removeInteraction(this._snapInteraction);\n     this._snapInteraction = null;\n  }\n  //rimove l'interazione e setta a null drawInteracion\n  this.removeInteraction(this.drawInteraction);\n  this.drawInteraction = null;\n  // rtirna semprte true\n  return true;\n};\n\nproto._removeLastPoint = function() {\n  if (this.drawInteraction) {\n    // provo a rimuovere l'ultimo punto. Nel caso non esista la geometria gestisco silenziosamente l'errore\n    try{\n      this.drawInteraction.removeLastPoint();\n    }\n    catch (e) {\n      //\n    }\n  }\n};\n\nmodule.exports = AddFeatureTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst GUI = g3wsdk.gui.GUI;\nconst t = g3wsdk.core.i18n.t;\nconst EditingTask = require('./editingtask');\n\n// oggetto che contiene tutte le timpologie di dialog, confirm etc ...\nlet Dialogs = {\n  delete: {\n    fnc: function(inputs) {\n      let d = $.Deferred();\n      GUI.dialog.confirm(t(\"editing.messages.delete_feature\"), function(result) {\n        if (result)\n          d.resolve(inputs);\n        else\n          d.reject(inputs);\n      });\n      return d.promise();\n    }\n  },\n  commit: {\n    fnc: function(inputs) {\n      let d = $.Deferred();\n      let close = inputs.close;\n      const buttons = {\n        SAVE: {\n          label: t(\"save\"),\n          className: \"btn-success\",\n          callback: function () {\n            d.resolve(inputs);\n          }\n        },\n        CANCEL: {\n          label: close ? t(\"exitnosave\") : t(\"annul\"),\n          className: close ? \"btn-danger\" : \"btn-primary\",\n          callback: function () {\n            d.reject();\n          }\n        }\n      };\n      if (close) {\n        buttons.CLOSEMODAL = {\n          label:  t(\"annul\"),\n          className: \"btn-primary\",\n          callback: function () {\n            dialog.modal('hide');\n          }\n        }\n      }\n      // NOW I HAVE TO IMPLEMENT WHAT HAPPEND ID NO ACTION HAPPEND\n      const dialog = GUI.dialog.dialog({\n        message: inputs.message,\n        title: t(\"editing.messages.commit_feature\") + \" \" +inputs.layer.getName() + \"?\",\n        buttons: buttons\n      });\n      return d.promise()\n    }\n  }\n};\n\nfunction ConfirmTask(options = {}) {\n  let type = options.type || \"default\";\n  this._dialog = Dialogs[type];\n  base(this, options);\n}\n\ninherit(ConfirmTask, EditingTask);\n\nlet proto = ConfirmTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  console.log('Confirm Feature Task run ....');\n  return this._dialog.fnc(inputs);\n};\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  return true;\n};\n\n\n\nmodule.exports = ConfirmTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst DeleteInteraction = g3wsdk.ol.interactions.DeleteFeatureInteraction;\nconst EditingTask = require('./editingtask');\n\nfunction DeleteFeatureTask(options) {\n  this.drawInteraction = null;\n  this._selectInteraction = null;\n  base(this, options);\n}\n\ninherit(DeleteFeatureTask, EditingTask);\n\n\nconst proto = DeleteFeatureTask.prototype;\n\n/* BRUTTISSIMO! Tocca ridefinire tutte le parti internet di OL3 non esposte dalle API */\n\nol.geom.GeometryType = {\n  POINT: 'Point',\n  LINE_STRING: 'LineString',\n  LINEAR_RING: 'LinearRing',\n  POLYGON: 'Polygon',\n  MULTI_POINT: 'MultiPoint',\n  MULTI_LINE_STRING: 'MultiLineString',\n  MULTI_POLYGON: 'MultiPolygon',\n  GEOMETRY_COLLECTION: 'GeometryCollection',\n  CIRCLE: 'Circle'\n};\n\n\nconst white = [255, 255, 255, 1];\nconst red = [255, 0, 0, 1];\nconst width = 3;\n\n//vado a definre lo stile della feature selezionata per essere cancellata\nconst styles = {};\nstyles[ol.geom.GeometryType.POLYGON] = [\n  new ol.style.Style({\n    stroke: new ol.style.Stroke({\n      color: 'red',\n      width: 3\n    }),\n    fill: new ol.style.Fill({\n      color: 'rgba(255, 0, 0, 0.1)'\n    })\n  })\n];\nstyles[ol.geom.GeometryType.MULTI_POLYGON] = styles[ol.geom.GeometryType.POLYGON];\n\nstyles[ol.geom.GeometryType.LINE_STRING] = [\n  new ol.style.Style({\n    stroke: new ol.style.Stroke({\n      color: white,\n      width: width + 2\n    })\n  }),\n  new ol.style.Style({\n    stroke: new ol.style.Stroke({\n      color: red,\n      width: width\n    })\n  })\n];\n\nstyles[ol.geom.GeometryType.MULTI_LINE_STRING] = styles[ol.geom.GeometryType.LINE_STRING];\n\nstyles[ol.geom.GeometryType.CIRCLE] = styles[ol.geom.GeometryType.POLYGON].concat(styles[ol.geom.GeometryType.LINE_STRING]);\n\nstyles[ol.geom.GeometryType.POINT] = [\n  new ol.style.Style({\n    image: new ol.style.Circle({\n      radius: width * 2,\n      fill: new ol.style.Fill({\n        color: red\n      }),\n      stroke: new ol.style.Stroke({\n        color: white,\n        width: width / 2\n      })\n    }),\n    zIndex: Infinity\n  })\n];\nstyles[ol.geom.GeometryType.MULTI_POINT] = styles[ol.geom.GeometryType.POINT];\n\nstyles[ol.geom.GeometryType.GEOMETRY_COLLECTION] = styles[ol.geom.GeometryType.POLYGON].concat(styles[ol.geom.GeometryType.LINE_STRING], styles[ol.geom.GeometryType.POINT]);\n\nstyles[ol.geom.GeometryType.POLYGON] = _.concat(styles[ol.geom.GeometryType.POLYGON],styles[ol.geom.GeometryType.LINE_STRING]);\n\nstyles[ol.geom.GeometryType.GEOMETRY_COLLECTION] = _.concat(styles[ol.geom.GeometryType.GEOMETRY_COLLECTION],styles[ol.geom.GeometryType.LINE_STRING]);\n\n/* FINE BRUTTISSIMO! */\n\n// run del tool di delete feature\n// che ritorna una promessa\nproto.run = function(inputs, context) {\n  console.log('Delete task run.......');\n  var self = this;\n  var d = $.Deferred();\n  var editingLayer = inputs.layer;\n  var originaLayer = context.layer;\n  var layerId = originaLayer.getId();\n  //recupero la sessione dal context\n  var session = context.session;\n  this._selectInteraction = new ol.interaction.Select({\n    layers: [editingLayer],\n    condition: ol.events.condition.click,\n    style: function(feature) {\n      var style = styles[feature.getGeometry().getType()];\n      return style;\n    }\n  });\n  this.addInteraction(this._selectInteraction);\n  this._deleteInteraction = new DeleteInteraction({\n    features: this._selectInteraction.getFeatures(), // passo le features selezionate\n    layer: editingLayer // il layer appartenente\n  });\n  this.addInteraction(this._deleteInteraction);\n  this._deleteInteraction.on('deleteend', function(e) {\n    const feature = e.features.getArray()[0];\n    const EditingService = require('../../../services/editingservice');\n    const RelationService = require('../../../services/relationservice');\n    const relations = originaLayer.getRelations()? originaLayer.getRelations().getArray() : [];\n    const relationsInEditing = EditingService.getRelationsInEditing(relations, feature, feature.isNew());\n    inputs.features = [feature];\n    relationsInEditing.forEach((relation) => {\n      let updateRelation = true;\n      let relationService = new RelationService({\n        relation: relation.relation,\n        relations: relation.relations\n      });\n      const relationLayer = EditingService.getLayerById(relation.relation.child);\n      relationLayer.getEditingFields().forEach((field) => {\n        if (field.name === relation.relation.childField && field.validate.required)\n          updateRelation = false;\n      });\n      if (updateRelation) {\n        const relationsLength = relation.relations.length;\n        for (let index = 0; index < relationsLength ; index++) {\n          relationService.unlinkRelation(0)\n        }\n      }\n    });\n    // vado a cancellare dalla source la feature selezionata\n    editingLayer.getSource().removeFeature(feature);\n    self._selectInteraction.getFeatures().remove(feature);\n    // dico di cancellarla (la feature non viene cancellatata ma aggiornato il suo stato\n    session.pushDelete(layerId, feature);\n    //dovrei aggiungere qui qualcosa per salvare temporaneamente quesa modifica sulla sessione al fine di\n    // portare tutte le modifiche quando viene fatto il save della sessione\n    // ritorno come outpu l'input layer che sarà modificato\n    d.resolve(inputs);\n  });\n  return d.promise();\n};\n\nproto.stop = function() {\n  console.log('Stop delete task ....');\n  return new Promise((resolve, reject) => {\n    this._selectInteraction.getFeatures().clear();\n    this.removeInteraction(this._selectInteraction);\n    this._selectInteraction = null;\n    // funzione che mi fa il resete di tuttle le modalità inserite dall'interazione\n    this._deleteInteraction.clear();\n    this.removeInteraction(this._deleteInteraction);\n    this._deleteInteraction = null;\n    resolve(true);\n  })\n\n};\n\n\nmodule.exports = DeleteFeatureTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst GUI = g3wsdk.gui.GUI;\nconst Task = g3wsdk.core.workflow.Task;\n\nfunction EditingTask(options) {\n  options = options || {};\n  base(this, options);\n  this._mapService = GUI.getComponent('map').getService();\n  this.addInteraction = function(interaction) {\n    this._mapService.addInteraction(interaction);\n  };\n  this.removeInteraction = function(interaction) {\n    this._mapService.removeInteraction(interaction);\n  };\n}\n\ninherit(EditingTask, Task);\n\nconst proto = EditingTask.prototype;\n\nproto.run = function(inputs, context) {};\n\nproto.stop = function() {};\n\nmodule.exports = EditingTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst EditingTask = require('./editingtask');\nconst GUI = g3wsdk.gui.GUI;\nconst PickFeatureInteraction = g3wsdk.ol.interactions.PickFeatureInteraction;\n\n\n// classe  per l'aggiungere una relazione\nfunction LinkRelationTask(options) {\n  options = options || {};\n  base(this, options);\n}\n\ninherit(LinkRelationTask, EditingTask);\n\nconst proto = LinkRelationTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  const d = $.Deferred();\n  GUI.setModal(false);\n  const originalLayer = context.layer;\n  const layerType = originalLayer.getType();\n  //var style = this.editor._editingVectorStyle ? this.editor._editingVectorStyle.edit : null;\n  // vado a settare i layers su cui faccio l'interacion agisce\n  const editingLayer = inputs.layer;\n  if (layerType == 'vector') {\n    this.pickFeatureInteraction = new PickFeatureInteraction({\n      layers: [editingLayer]\n    });\n    // aggiungo\n    this.addInteraction(this.pickFeatureInteraction);\n    // gestisco l'evento\n    this.pickFeatureInteraction.on('picked', function(e) {\n      const relation = e.feature;\n      inputs.features.push(relation);\n      GUI.setModal(true);\n      d.resolve(inputs);\n    });\n  } else {\n\n  }\n\n  return d.promise()\n};\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  GUI.setModal(true);\n  this.removeInteraction(this.pickFeatureInteraction);\n  this.pickFeatureInteraction = null;\n  return true;\n};\n\n\nmodule.exports = LinkRelationTask;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\n\nvar EditingTask = require('./editingtask');\n\nfunction ModifyGeometryVertexTask(options={}){\n  this.drawInteraction = null;\n  this._originalStyle = null;\n  this._feature = null;\n  this._deleteCondition = options.deleteCondition || undefined;\n  this._snap = options.snap === false ? false : true;\n  this._snapInteraction = null;\n  base(this, options);\n}\n\ninherit(ModifyGeometryVertexTask, EditingTask);\n\n\nvar proto = ModifyGeometryVertexTask.prototype;\n\nproto.run = function(inputs, context) {\n  var d = $.Deferred();\n  var editingLayer = inputs.layer;\n  var session = context.session;\n  var originalLayer = context.layer;\n  var layerId = originalLayer.getId();\n  var originalFeature,\n    newFeature;\n  var feature = this._feature = inputs.features[0];\n  this._originalStyle = editingLayer.getStyle();\n  var style = [\n    new ol.style.Style({\n      stroke : new ol.style.Stroke({\n        color : \"grey\",\n        width: 3\n      })\n    }),\n    new ol.style.Style({\n      image: new ol.style.Circle({\n        radius: 5,\n        fill: new ol.style.Fill({\n          color: 'orange'\n        })\n      }),\n      geometry: function(feature) {\n        // return the coordinates of the first ring of the polygon\n        var coordinates = feature.getGeometry().getCoordinates()[0];\n        return new ol.geom.MultiPoint(coordinates);\n      }\n    })\n  ];\n  feature.setStyle(style);\n  var features = new ol.Collection(inputs.features);\n  this._modifyInteraction = new ol.interaction.Modify({\n    features: features,\n    deleteCondition: this._deleteCondition\n  });\n\n  this.addInteraction(this._modifyInteraction);\n\n  this._modifyInteraction.on('modifystart', function(e) {\n    var feature = e.features.getArray()[0];\n    originalFeature = feature.clone();\n  });\n\n  this._modifyInteraction.on('modifyend',function(e){\n    var feature = e.features.getArray()[0];\n    if (feature.getGeometry().getExtent() != originalFeature.getGeometry().getExtent()) {\n      newFeature = feature.clone();\n      session.pushUpdate(layerId, newFeature, originalFeature);\n      //self._selectInteraction.getFeatures().clear();\n      inputs.features.push(newFeature);\n      // ritorno come outpu l'input layer che sarà modificato\n      d.resolve(inputs);\n    }\n  });\n\n  /*if (this._snap) {\n    this._snapInteraction = new ol.interaction.Snap({\n      source: editingLayer.getSource()\n    });\n    this.addInteraction(this._snapInteraction);\n  }*/\n\n  return d.promise();\n};\n\n\nproto.stop = function(){\n  if (this._snapInteraction) {\n     this.removeInteraction(this._snapInteraction);\n     this._snapInteraction = null;\n  }\n  this._feature.setStyle(this._originalStyle);\n  this.removeInteraction(this._modifyInteraction);\n  this._modifyInteraction = null;\n  return true;\n};\n\nproto.removePoint = function(coordinate){\n  if (this._modifyInteraction) {\n    // provo a rimuovere l'ultimo punto. Nel caso non esista la geometria gestisco silenziosamente l'errore\n    try{\n      this._modifyInteraction.removePoint();\n    }\n    catch (e){\n      console.log(e);\n    }\n  }\n};\n\nproto._isNew = function(feature){\n  return (!_.isNil(this.editingLayer.getSource().getFeatureById(feature.getId())));\n};\n\nmodule.exports = ModifyGeometryVertexTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst EditingTask = require('./editingtask');\n\nfunction MoveFeatureTask(options){\n  this.drawInteraction = null;\n  base(this, options);\n}\n\ninherit(MoveFeatureTask, EditingTask);\n\nconst proto = MoveFeatureTask.prototype;\n\nproto.run = function(inputs, context) {\n  const d = $.Deferred();\n  const session = context.session;\n  const editingLayer = inputs.layer;\n  const feature = inputs.features[0];\n  const originalLayer = context.layer;\n  const layerId = originalLayer.getId();\n  const originalStyle = editingLayer.getStyle();\n  const style = new ol.style.Style({\n    fill: new ol.style.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    stroke: new ol.style.Stroke({\n      color: '#ffcc33',\n      width: 3\n    }),\n    image: new ol.style.Circle({\n      radius: 7,\n      fill: new ol.style.Fill({\n        color: '#ffcc33'\n      })\n    })\n  });\n  const features = new ol.Collection(inputs.features);\n  let originalFeature = null;\n  feature.setStyle(style);\n  this._translateInteraction = new ol.interaction.Translate({\n    features: features,\n    hitTolerance: (isMobile && isMobile.any) ? 10 : 0\n  });\n  this.addInteraction(this._translateInteraction);\n\n  this._translateInteraction.on('translatestart',function(e){\n    const feature = e.features.getArray()[0];\n    // repndo la feature di partenza\n    originalFeature = feature.clone();\n  });\n  \n  this._translateInteraction.on('translateend',function(e) {\n    const feature = e.features.getArray()[0];\n    const newFeature = feature.clone();\n    session.pushUpdate(layerId, newFeature, originalFeature);\n    // ritorno come output l'input layer che sarà modificato\n    inputs.features.push(newFeature);\n    feature.setStyle(originalStyle);\n    d.resolve(inputs);\n  });\n  return d.promise()\n};\n\n\nproto.stop = function() {\n  const d = $.Deferred();\n  this.removeInteraction(this._translateInteraction);\n  this._translateInteraction = null;\n  d.resolve();\n  return d.promise();\n};\n\n\n\nmodule.exports = MoveFeatureTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst t = g3wsdk.core.i18n.t;\nconst GUI = g3wsdk.gui.GUI;\nconst WorkflowsStack = g3wsdk.core.workflow.WorkflowsStack;\nconst EditingTask = require('./editingtask');\nconst EditingFormComponent = require('../../../form/editingform');\n\nfunction OpenFormTask(options={}) {\n  // prefisso delle nuove  feature\n  this._formIdPrefix = 'form_';\n  this._isContentChild = false;\n  this._feature;\n  this._originalLayer;\n  this._editingLayer;\n  this._layerName;\n  this._originalFeature;\n  this._pk;\n  this._fields;\n  this._session;\n  this._editorFormStructure;\n  base(this, options);\n}\n\ninherit(OpenFormTask, EditingTask);\n\nmodule.exports = OpenFormTask;\n\nconst proto = OpenFormTask.prototype;\n\n\nproto._getFieldUniqueValuesFromServer = function(layer, uniqueFields) {\n  const fieldsName = _.map(uniqueFields, (field) => {\n    return field.name\n  });\n  layer.getWidgetData({\n    type: 'unique',\n    fields: fieldsName.join()\n  }).then(function(response) {\n    const data = response.data;\n    _.forEach(data, function(values, fieldName) {\n      _.forEach(values, function(value) {\n        uniqueFields[fieldName].input.options.values.push(value);\n      })\n    })\n  }).fail(function(){\n    console.log('errore')\n  })\n};\n\nproto._getUniqueFieldsType = function(fields) {\n  const uniqueFields = {};\n  _.forEach(fields, function(field) {\n     if (field.input.type == 'unique')\n       uniqueFields[field.name] = field;\n  });\n  return uniqueFields;\n};\n\nproto._getForm = function(inputs, context) {\n  const excludeFields = context.excludeFields;\n  this._isContentChild = !!(WorkflowsStack.getLength() > 1);\n  this._session = context.session;\n  // vado a recuperare i\n  this._originalLayer = context.layer;\n  this._editingLayer = inputs.layer;\n  this._pk = this._originalLayer.getPk();\n  this._layerName = this._originalLayer.getName();\n  // vado a prendere l'ultima feature\n  this._feature = inputs.features[inputs.features.length - 1];\n  this._originalFeature = this._feature.clone();\n  this._fields = this._originalLayer.getFieldsWithValues(this._feature, {\n    exclude: excludeFields\n  });\n  this._editorFormStructure = this._originalLayer.getEditorFormStructure();\n  const uniqueFields = this._getUniqueFieldsType(this._fields);\n  if (!_.isEmpty(uniqueFields))\n    this._getFieldUniqueValuesFromServer(this._originalLayer, uniqueFields);\n  return GUI.showContentFactory('form');\n};\n\nproto._cancelFnc = function(promise, inputs) {\n  GUI.setModal(false);\n  promise.reject(inputs);\n};\n\nproto._saveFnc = function(promise, inputs) {\n  return function(fields) {\n    const newFeature = this._feature;\n    const layerId = this._originalLayer.getId();\n    // vado a settare per quel layer i valori ai campi\n    this._originalLayer.setFieldsWithValues(newFeature, fields);\n    // verifico se non è nuovo\n    if (!newFeature.isNew()) {\n      this._session.pushUpdate(layerId, newFeature, this._originalFeature);\n    } else {\n      //vado ad aggiungere la feature\n      if (this._originalLayer.isPkEditable())\n        _.forEach(fields, function (field) {\n          if (field.name == newFeature.getPk())\n            newFeature.set(newFeature.getPk(), field.value);\n        });\n    }\n    GUI.setModal(false);\n    promise.resolve(inputs);\n  }\n};\n\nproto.startForm = function(options = {}) {\n  const inputs = options.inputs;\n  const context = options.context;\n  const promise = options.promise;\n  const formComponent = options.formComponent || EditingFormComponent;\n  const Form = this._getForm(inputs, context);\n  const formService = Form({\n    formComponent: formComponent,\n    title: t(\"editing_attributes\") + \" \" + this._layerName,\n    name: t(\"editing_attributes\") + \" \" + this._layerName,\n    id: this._generateFormId(this._layerName),\n    dataid: this._layerName,\n    layer: this._originalLayer,\n    pk: this._pk,\n    isnew: this._originalFeature.isNew(),\n    fields: this._fields,\n    relationsOptions:  {\n      context: context,\n      inputs: inputs\n    },\n    formStructure: this._editorFormStructure,\n    modal: true,\n    perc: this._editorFormStructure ? 100 : null,\n    push: this._isContentChild, // indica se posso aggiungere form\n    showgoback: !this._isContentChild, // se è figlo evito di visualizzare il go back\n    buttons:[{\n      title: t(\"save\"),\n      type: \"save\",\n      class: \"btn-success\",\n      cbk: _.bind(this._saveFnc(promise, inputs), this)\n    }, {\n      title: t(\"cancel\"),\n      type: \"cancel\",\n      class: \"btn-primary\",\n      cbk: _.bind(this._cancelFnc, this, promise, inputs)\n    }]\n  });\n  context.formService = formService;\n};\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  const d = $.Deferred();\n  this.startForm({\n    inputs: inputs,\n    context: context,\n    promise: d\n  });\n  return d.promise();\n};\n\n\nproto._generateFormId = function(layerName) {\n  return this._formIdPrefix + layerName;\n};\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  this._isContentChild ? GUI.popContent() : GUI.closeForm();\n};\n\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst t = g3wsdk.core.i18n.t;\nconst GUI = g3wsdk.gui.GUI;\nconst TableComponent = require('../../../table/vue/table');\nconst EditingTask = require('./editingtask');\nconst WorkflowsStack = g3wsdk.core.workflow.WorkflowsStack;\n\nfunction OpenTableTask(options) {\n\n  options = options || {};\n  // prefisso delle nuove  feature\n  this._formIdPrefix = 'form_';\n  this._isContentChild = false;\n  base(this, options);\n}\n\ninherit(OpenTableTask, EditingTask);\n\nconst proto = OpenTableTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  console.log('Open Table Task task run.......');\n  const d = $.Deferred();\n  const originalLayer = context.layer;\n  const layerName = originalLayer.getName();\n  const headers = originalLayer.getEditingFields();\n  this._isContentChild = !!(WorkflowsStack.getLength() > 1);\n  const foreignKey = this._isContentChild ? context.excludeFields[0] :  null;\n  // vado a recuperare i\n  const editingLayer = inputs.layer;\n  const features = editingLayer.getSource().readFeatures();\n  const action = this._isContentChild ? t('editing.relation.table.link.title') : t('editing.relation.table.edit.title') ;\n  const content = new TableComponent({\n    title: `${layerName}`,\n    features,\n    promise: d,\n    isrelation: this._isContentChild,\n    headers,\n    context,\n    inputs,\n    fatherValue: context.fatherValue,\n    foreignKey\n  });\n  GUI.showContent({\n    content,\n    push: this._isContentChild,\n    showgoback: !features.length, // if no features show back button\n    closable: false\n  });\n  return d.promise();\n};\n\nproto._generateFormId = function(layerName) {\n  return this._formIdPrefix + layerName;\n};\n\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  console.log('stop open table task ...');\n  this._isContentChild ? GUI.popContent() : GUI.closeForm();\n  return true;\n};\n\nmodule.exports = OpenTableTask;\n\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar PickFeatureInteraction = g3wsdk.ol.interactions.PickFeatureInteraction;\nvar EditingTask = require('./editingtask');\n\nfunction PickFeatureTask(options) {\n  this.pickFeatureInteraction = null;\n  this._busy = false;\n  this._tools = options.tools || [];\n  base(this, options);\n}\n\ninherit(PickFeatureTask, EditingTask);\n\nvar proto = PickFeatureTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  console.log('Pick Feature Task run ....');\n  var d = $.Deferred();\n  //var style = this.editor._editingVectorStyle ? this.editor._editingVectorStyle.edit : null;\n  // vado a settare i layers su cui faccio l'interacion agisce\n  var layers = [inputs.layer];\n  var features = inputs.features.length ? inputs.features : null;\n  this.pickFeatureInteraction = new PickFeatureInteraction({\n    layers: layers,\n    features: features\n  });\n  // aggiungo\n  this.addInteraction(this.pickFeatureInteraction);\n  // gestisco l'evento\n  this.pickFeatureInteraction.on('picked', function(e) {\n    var feature = e.feature;\n    if (!features)\n      inputs.features.push(feature);\n    d.resolve(inputs);\n  });\n  return d.promise()\n};\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  console.log('Stop pick feature');\n  this.removeInteraction(this.pickFeatureInteraction);\n  this.pickFeatureInteraction = null;\n  return true;\n};\n\n\nmodule.exports = PickFeatureTask;\n"],"sourceRoot":""}